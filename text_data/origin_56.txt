b'IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\n1379LosslessCompressionofColorMosaicImages\nNingZhangandXiaolinWu\n,SeniorMember,IEEE\nAbstractLosslesscompressionofcolormosaicimagesposesa\nuniqueandinterestingproblemofspectraldecorrelationofspa-\n\ntiallyinterleavedR,G,Bsamples.Weinvestigatereversibleloss-\n\nlessspectral-spatialtransformsthatcanremovestatisticalredun-\n\ndanciesinbothspectralandspatialdomainsanddiscoverthata\n\nparticularwaveletdecompositionscheme,calledMallatwavelet\n\npackettransform,isideallysuitedtothetaskofdecorrelatingcolor\n\nmosaicdata.Wealsoproposealow-complexityadaptivecontext-\n\nbasedGolombRicecodingtechniquetocompressthecoefcients\n\nofMallatwaveletpackettransform.Thelosslesscompressionper-\n\nformanceoftheproposedmethodoncolormosaicimagesisappar-\n\nentlythebestsofaramongtheexistinglosslessimagecodecs.\nIndexTerms\nContextquantization,entropycoding,digital\ncamera,imagecompression.\nI.I\nNTRODUCTION\nMOSTdigitalcamerasuseimagesensorsthatsampleonly\noneofthethreeprimarycolorsateachpixelposition.\nSpecically,eachpixeliscoveredwithalterandrecordsjust\n\noneofthethreeprimarycolors:red,greenorblue.Thesepri-\nmarycolorsamplesareinterleavedinatwo-dimensional(2-D)\ngrid,orcolormosaic,resemblingathree-colorcheckerboard.\n\nThemostpopularsingleCCDcolormosaicpatternistheone\n\nproposedbyBayer[1].Toreconstructthetruecontinuous-tone\ncolor,aprocedurecalledcolordemosaickingisneededtointer-\npolatetheothertwomissingprimarycolorsateachpixel.The\n\nimagequalityofdigitalcameraslargelydependsontheperfor-\n\nmanceofthecolordemosaickingprocess.\nImagedatacompressionisanimportantcomponentofdig-\nitalcameradesignanddigitalphotography.Itismorethanjust\n\nanissueofsavingstorageandbandwidth,butrathertobecon-\n\nsideredinlightofoverallsystemperformanceandfunctionality,\nparticularlyinrelationtocolordemosaicking.Currently,alldig-\nitalcamerascarryoutcolordemosaickingpriortocompression,\n\napparentlyduetotheconsiderationsofeasyuserinterfaceand\n\ndevicecompatibility.However,industrialpolicyandstandard\nissuesaside,inouropinion,thisdesignissuboptimal.Color\ndemosaickingtriplestheamountofrawdatabygeneratingR,\n\nG,Bbandsviacolorinterpolation.Ironically,thetaskofcom-\n\npressionneedstodecorrelatethethreebands,whichessentially\nattemptstoreverseengineerthecolorinterpolationprocessof\ndemosaicking.Thisdemosaicking-rstandcompression-later\nManuscriptreceivedSeptember29,2004;revisedApril18,2005.This\nworkwassupportedinpartbytheNaturalSciencesandEngineeringResearch\nCouncilofCanadaundertheNSERC-DALSAIndustrialResearchChairin\nDigitalCinema.Theassociateeditorcoordinatingthereviewofthismanuscript\nandapprovingitforpublicationwasDr.GiovanniPoggi.\nTheauthorsarewiththeDepartmentofElectricalandComputerEngi-\nneering,McMasterUniversity,Hamilton,ONL8K4K1Canada(e-mail:\nningzhang@mail.ece.mcmaster.ca;xwu@ece.mcmaster.ca).\nDigitalObjectIdentier10.1109/TIP.2005.871116\ndesignunnecessarilyincreasesalgorithmcomplexity,reduces\ncompressionratio,andburdenstheon-cameraI/Obandwidth.\nInthispaper,weproposetocompressandstorethecolor\nmosaicdatadirectly,andperformdemosaickingtoreconstruct\ntheR,G,Bbandsafterward,possiblyofine.Thisrelievesthe\n\ncamerafromthetasksofcolordemosaickingandcolordecorre-\n\nlationandalsoreducestheamountofinputdatatocompression\ncodecintherstplace.Thenewworkowcanpotentiallyre-\nduceon-cameracomputingpowerandI/Obandwidth.Moreim-\n\nportantly,thenewdesignallowslosslessornear-losslesscom-\n\npressionofrawmosaicdata,whichisthemainthemeofthis\npaper.\nFormanyhigh-enddigitalphotographyapplications,such\nasdigitalarchivingofpreciousmuseumartsandrelics,pro-\nfessionaladvertising,anddigitalcinemaforwhichhighimage\nqualityisparamount,itiscrucialtohavetheoriginalcolormo-\n\nsaicdatainlosslessformat.Ourrecentresultsincolordemo-\n\nsaickingresearch[2]indicatethatsuperiorimagequalitycanbe\nobtainedbymoresophisticatedcolordemosaickingalgorithms\nthanthoseimplementedoncamera,providedthatoriginalmo-\n\nsaicdataareavailable.Furthermore,otherimage/videoappli-\n\ncations,suchassuper-resolutionimagingandmotionanalysis,\nshouldalsobenetfromlosslesscompressionofcolormosaic\ndata,inwhichevensubpixelprecisionismuchdesired.\nLosslesscompressionofmosaiccolorimagesposesaunique\nandinterestingproblemofspectraldecorrelation(ormore\ngenerallystatisticalmodeling)ofspatiallyinterleavedR,G,B\nsamples.BecauseacolormosaicimageconsistsofinterlacedR,\n\nG,Bsamples,existingdecorrelationtechniquessuchasDPCM,\n\nDCT,andwaveletsmaynotworkeffectivelybytreatingamo-\nsaicimageasagrayscaleone.Inthispaper,weexaminea\nnumberofinterbandcodingtechniquesforlosslesscodingof\n\ncolormosaicimages.Ourfocusisonreversiblelosslessspec-\n\ntral-spatialtransformsthatcanremovestatisticalredundancies\ninbothspectralandspatialdomains.Interestingly,wediscover\nthatauniquewaveletdecompositionscheme,calledtheMallat\n\npackettransform,isideallysuitedtothetaskofdecorrelating\n\ncolormosaicdata.\nThepresentationisorganizedasfollows.SectionIIpresents\nandevaluatessomeschemesofcodingmosaicimagesbyde-in-\n\nterleavingR,G,Bsamplespriortocompression.InSectionIII,\n\nweconsideranalternativeapproachofcompressingcolormo-\nsaicimagesdirectlywithoutde-interleavingthecolorbands.We\nstudythestrengthandweaknessofbothDPCMandwavelet-\n\nbasedlosslesscodingmethodsintheabovetwodifferentap-\n\nproaches.SectionIVoffersawaveletanalysisofmosaicimages.\nTheanalysisleadstoanewwaveletdecompositionschemethat\niswellsuitedforlosslesscodingofBayerpatternmosaicdata\n\ndirectlywithoutde-interleaving.Thisnewwaveletdecomposi-\n\ntion,whichresemblestheSPACLmodeofJPEG2000standard,\n1057-7149/$20.002006IEEE\n'b'1380IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\nhasthenicepropertyofdecorrelatingcolorsamplesbothspa-\ntiallyandspectrally.SectionVintroducesafastcontext-based\n\nGolombRicecodingschemetocompressthecoef\ncientsofthe\nproposedwavelettransform.SectionVIpresentsexperimental\nresultsandSectionVIIconcludes.\nII.D\nEINTERLEAVED\nCOMPRESSIONSincemostdigitalcamerasuseCCDsensorarraysofBayer\npattern,weareconcernedwiththelosslesscompressionofcolor\n\nmosaicimagesofBayerpattern,butthetechniquestobede-\nvelopedinthispapercanbegeneralizedtoothermosaiccolor\nsamplingschemes.TheBayercolor\nlterarrayandaresulting\nmosaicimagearepresentedinFig.1.\nLetbethecolorsampleatpixelposition\n,then\ntheBayercolormosaicpatternisde\nnedby\niseven\nisodd\niseven\niseven\nisodd\n(1)Anaturalwayofcompressingcolormosaicimagesisto\nrstdeinterleavethethreecolorchannels,andthencodeeachofthe\n\nthreedown-sampledcolorchannelsindividually.Speci\ncally,\ntheBayerpattern\ncanbede-interleavedintothefollowingthreedown-sampled\ncolorchannels:\nLetusdevelopageneralframeworkforde-interleavedcom-\npressionofmosaicimages.First,wecodethegreenchannelbe-\n\nforetheothertwochannels,becausethegreenchannelhastwice\n\nasmanysamplesand,hence,higherintrachannelcorrelation.\nOncethegreensamplesarecoded,weutilizetheinterchannel\ncorrelationtocompressredandbluechannels,butoneproblem\n\nneedstobeaddressed.IntheBayerpattern,thegreenchannel\n\nconsistsofadiamondgrid(orso-calledquincunxarray),while\nallexistinglosslessimagecompressionstandardsoperateon\nFig.1.Bayerpatternandanexampleofmosaicimage:(a)Bayercolor\nlterarray;(b)anoriginalcolorimage:Monarch;(c)Bayerpatternmosaic\nimageoftheselectedregionin(b).(Colorversionavailableonlineat\nhttp://ieeexplore.ieee.org.)\nsquaresamplegrid.Weneedtotransformthegreenquincunx\narraytorectangulararrayinpreparingitforcompression.There\n\naremanywaysoftransformingordeinterleavingthediamond\n\nsamplegridintoasquaresamplegrid.Weexaminethefollowing\nfour.\n1)Merge:\nThequincunxarrayisconvertedtorectangular\narraybyshiftingalloddcolumnsonepixeltotheleftand\nform2)Reversiblede-interlacer:\nThisschemewasproposedforlossycompressionof\nBayerpatternmosaicdata[3],[4].Oddcolumndataare\n'b'ZHANGANDWU:LOSSLESSCOMPRESSIONOFCOLORMOSAICIMAGES\n1381passedthroughaverticallow-pass\nlterbeforemerging\nwithevencolumns,namely\n(2)Sinceincreasesthedynamicrangeof\nbyone\nbit,theabovetransformbecomesinef\ncientforlossless\ncoding.Inotherwords,ifthebinaryrepresentationof\nhasbits,arerequiredtorepre-\nsentinordertohavelosslessinversetransform.Al-\nthoughandhavethesamedynamicrangein\n(2),anextrabitisneededtoresolvetheparityofthesum\n\nforlosslessreconstruction.\n3)Separation4)Rotation\nAfteroneoftheabovedeinterleavingtransforms,thegreen\nchannelcanbecodedusinganyoftheexistinglosslessimage\n\ncodecs,suchasJPEG-LSandJPEG2000losslessmode.TableI\n\nliststhebitratesofthelosslessimagecompressionstandards\nJPEG-LS[5]andJPEG-2000[6](losslessmode)ontheout-\nputsofthreeoftheabovedeinterleavingtransforms.InTableI,\n\nforeachtestimage,thenumberinboldfacerepresentsthebest\n\nresultamongalldeinterleavingtransforms.Thereisnosingle\nwinningtransformforalltheimages.Notsurprisingly,thesep-\narationtransformperformstheworstonaveragebecauseitdis-\n\nregardsthecorrelationbetweenthetworesultingsubimages\n\nofgreensamples.Thecompressionresultsofthemergeand\nrotationtransformsareverycloseforagivenlosslessimage\ncodec.InourcomparisonstudyJPEG-LSachievesbetterloss-\n\nlesscompressionthanJPEG-2000onalltestimagesforthe\n\nde-interleavingmethodsofseparationandmerge.Fortherota-\ntionmethod,wepresentonlytheresultsofJPEG-LSnotthose\nofJPEG2000,becauseitisrelativelyeasytomodifyJPEG-LS\n\ntocodetherotatedimagebutverydif\nculttodothesamewith\nJPEG2000.\nOncethegreenchanneliscodedandmadeknowntothede-\ncoder,itcanbeusedasananchortofacilitatethecompression\n\nofredandbluechannelsbyexploitingthespectralcorrelation.\n\nTothisend,weestimatethemissinggreenvaluesfromtheex-\nistinggreensamplesatthepixelpositionswhereeitherredor\nbluesampleistaken.Wedenotesuchestimatesby\n,where\nthevalueof\nisodd,todistinguishthemfromtheexisting\ngreensamples\n,wherethevalueof\niseven.Rather\nTABLEI\nLOSSLESSBITRATESOF\nGREENCHANNELUNDERDIFFERENTDEINTERLEAVING\nTRANSFORMSWHILEBEINGCOMPRESSEDBYJPEG-LSANDJPEG2000\nTABLEII\nLOSSLESSBITRATESOF\nREDAND\nBLUEMOSAICSAMPLESUSINGJPEG-LSthancode\nandseparately,welosslesslycodethe\ntwocolordifferenceimages\nand(3)Sincethedecodercanmakethesameestimates\nasthe\nencoder,itcanreconstructtheoriginal\nandfromandwithoutanyloss.Thedifferenceimages\nand,whichcanberegardedapproximatelyastwochromi-\nnancecomponents,aremorecompressiblethan\norbecausetheyaretypicallylow-passsignalsduetotheinter-\nchannelcorrelation.Furthermore,thecolordifferenceimages\nandprovidevitalinformationinmanycolorde-\nmosaicingalgorithms[1],[7]\n[9].Therefore,losslesscodingof\nandservesdualpurposesoflosslesscompression\nofcolormosaicdataandcolordemosaicking.\nInestimatingthemissinggreensamples\n,wehave\nevaluatedvariousinterpolationschemes,includingbilinear\n\ninterpolation,bi-cubicB-Spline[9]andsomenonlinearmethods\n[7],[8].TableIIliststhelosslessbitratesoftheredand\nbluemosaicsamplesobtainedbythreecodingschemes:1)\n\nintrachannelcodingofredandblue;2)colordifferencecoding\n\nwithbilineargreeninterpolation;3)colordifferencecoding\nwithbi-cubicB-splinegreeninterpolation.Itisclearfrom\nTableIIthatcodingcolordifferencesismoreeffectivethan\n\ncodingtheredandbluechannelsindividually.Thecoding\n\ngainismorethan7.5%onaverage,whichisasigni\ncantmarginbythestandardoflosslessimagecoding.Theprecision\nofgreeninterpolationcanimprovethelosslesscompression\n\nofcolormosaicimages,butonlymarginally.Simplebilinear\n\ninterpolationworkssatisfactorily.\nTableIIIpresentstheoveralllosslessbitratesofJPEG-LSand\nJPEG2000losslessmodeonthede-interleavedgreenchannel\n\n(usingthemergedeinterleavingtransform)andthetwocolor\n\ndifferenceimages\nandwithbeingestimatedbybilinear\n'b'1382IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\nTABLEIII\nLOSSLESSBITRATESOF\nDEINTERLEAVED\nMOSAICIMAGESBY\nJPEG-LSANDJPEG2000\ninterpolation.Forcomparisonpurposes,wealsogivethere-\nsultsofcodingredandbluechannelsdirectlywithoutinterband\ndecorrelation.III.I\nNTERLEAVED\nCOMPRESSIONAnalternativeapproachtolosslesscompressionofcolor\nmosaicimagesistoprocessthemosaicdatadirectlywithout\nde-interleavingthecolorchannels.Inotherwords,thecom-\n\npressionalgorithmpretendsthatthecolormosaicimageis\n\nasingle-channelgrrayscaleimage.Thistreatmenthasthe\nadvantageofsimplercodecdesignandlowercomplexitythan\ncompressionafterde-interleaving.Thesimplestwayistoapply\n\nalosslessimagecodingalgorithmdirectlytorawcolormosaic\n\nimageswithoutanypreprocessing.Foraquickassessmentof\ndifferentcompressionmethods,whenappliedtomosaicimages\ndirectly,thereaderisreferredtoTableVIofSectionVI(not\n\nplacedheretosavespace)forthelosslessbitratesofJPEG-LS\n\nandJPEG2000(usingthe5-3integer\nlter)standardsonsome\ncommontestimages.\nInterestingly,andsomewhatsurprisingly,JPEG-2000outper-\nformsJPEG-LSbyasigni\ncantmargin(morethan10%),when\nbothappliedtocompresscolormosaicimageswithoutde-in-\nterleaving.Recallfromtheproceedingsectionthattheperfor-\n\nmancecomparisonbetweenthetwoalgorithmsinthecaseof\n\nde-interleavedcompressiongaveexactlyoppositeresults.This\nreversalinrelativecodingef\nciencyislargelyduetoafunda-\nmentaldifferenceindecorrelationmechanismsofthetwoal-\n\ngorithms:DPCMforJPEG-LSandliftingintegerwaveletfor\nJPEG2000.\nTheDPCMschemeissuitedtoremovelongtermmemoryof\nasmoothsignalinthespatialdomain.Itbecomesineffectiveon\ndecorrelatingmosaicimagesofperiodicpatterns.Theenergyof\namosaicimagecanbepackedintothespatial-frequencydomain\n\nofthewaveletfarmoreef\ncientlythaninthespatialdomain.To\nexposethisweaknessofDPCMonmosaicimages,inFig.2we\npresentthepredictionresidualimagesofJPEG-LSwhenbeing\nappliedtoanaturalimage[giveninFig.6(a)]anditsmosaic\n\ncounterpart[giveninFig.6(b)].TheDPCMresidualsignalof\n\nthemosaicimagehassigni\ncantlygreateramplitudethanthat\nofthenaturalimage.Moreover,theDPCMresidualsstillexhibit\ntheoriginalmosaicstructure,withtheirstatisticsfarfrombeing\n\ni.i.d.Inotherwords,themedianpredictorusedbyJPEG-LSfails\n\ntopackthesignalenergyanddecorrelatethesamples.\nFig.2.ResidualimagesofthemedianpredictorofJPEG-LS(themid-gray\nrepresentszero).(a)ResidualimageofBayermosaicimage.(b)Residualimage\noftheoriginalgreenchannel.\nLetuscompareinFig.3thehistogramsoftheprediction\nresidualimagesFig.2(a)andFig.2(b)ofJPEG-LS,forthemo-\nsaicimageandthecorrespondingnormalimage,respectively.It\niswellknownthattheDPCMresidualsofanormalimagesignal\n\nobeyaLaplaciandistribution,asbeingevidentinFig.3(b),\n\nbutthisisnolongertruefortheDPCMresidualsofamosaic\nimage.NotethatthedistributionofFig.3(a)ismultimodaland\nasymmetricagainsttheorigin.TheresidualsofJPEG-LSfor\n\nmosaicimagesdeviatedrasticallyfromaLaplaciandistribution,\n\nandtheycannotevenbemodeledbyageneralizedGaussian\ndistribution.Unfortunately,theentropycode(Golomb\nRicecode)ofJPEG-LSassumesaLaplaciandistributionofthe\n\npredictionresiduals.Thisseveremismatchbetweenthemodel\n\nandthesourcealsoexplainsthepoorperformanceofJPEG-LS\nonmosaicimages.Theproblemwillbecorrectedinthenext\ntwosections.\nIV.W\nAVELET\nANALYSISOF\nMOSAICIMAGES\nInasharpcontrasttoDPCM,thewavelet,beingatoolof\nfrequency\ntimeanalysis,cancompactlycharacterizeperiodic\ncolormosaicsignals,aswillbedemonstratedbytheanalysis\n\nofthissection.Basedontheanalysis,weproposeaunique\n'b'ZHANGANDWU:LOSSLESSCOMPRESSIONOFCOLORMOSAICIMAGES\n1383Fig.3.HistogramsofJPEG-LSresidualsformosaicimageandtheoriginal\ngreenchannel.(a)HistogramoftheresidualimageinFig.2(a).(b)Histogram\noftheresidualimageinFig.2(b).\nso-calledMallatpacketwavelettransformfordirectcompres-\nsionofmosaicimageswithoutde-interleaving.Aswewillsee,\ntheproposedwavelettransformsimultaneouslyperformsspatial\n\nandspectraldecorrelationofcolorsampleswithagreateaseand\n\natalowcost.\nLetusstartbyexamininganinterestinginterplaybetweenthe\nBayerpatternandthe2-Dintegerwavelettransformviasep-\n\narableone-dimensional(1-D)lifting.Onelevelofthewavelet\n\ntransformproducesfoursubbandsthathaveclearinterpretations\noftheattributesoftheBayercolorsignal.AsshowninFig.4,\na2-Dwavelettransform(afterdecimation)andtheBayerpat-\n\nternbothhavea2\n2periodicalsamplingpattern.Thiscorre-\nspondencemakes2-Dwavelettransformsveryef\ncienttorep-\nresenttheBayerpatterninfrequency\nspacedomain.Theeffect\nofperforminga2-Dwavelettransformonamosaicimageisil-\n\nlustratedbyFig.5.Inthisexample,theBayermosaicdataof\n\nauniformcolorimagearetransformedintofourconstantsub-\nbands,althoughtheinputmosaicimageis,itself,ahigh-fre-\nquencysignal.\nWecanexplaintheeffectofFig.5analyticallyusing,forex-\nample,the5-3integerwavelet.Otherwavelets,suchas9/7M,\n5/11-C[10],behavesimilarly.Thelow-andhigh-pass\nlersof\nthe5-3integerwaveletare\n(4)Afterapplyingthe2-Dlow-pass\nltertotheBayer\nmosaicimage,the\nsubbandcanbeinterpretedasthelu-\nminancechanneloftheoriginalfullcolorimage.Inawindow\n\nofsmoothcolor,wherered,green,andbluecolorcomponents\nareapproximatelyconstants(i.e.,\n,,),thecoef\ncientsinthe\nsubbandare\nFig.4.The2\n2periodicalsamplingpatternof(a)Bayermosaicdataand\n(b)2-Dwavelettransform.\nFig.5.Ef\nciencyofrepresentingBayerpatternmosaicimageinwavelet\ndomain:(a)auniformcolorimage;(b)Bayermosaicimage;(c)2-Dwavelet\ncoefcients.(Colorversionavailableonlineathttp://ieeexplore.ieee.org.)\nThislinearcombinationof\n,,and\nofrationalcoef\ncientsis\nanapproximationofthe\n(luminance)componentoftheNTSC\nYUVcolorspace.Interestingly,itisalsoexactlythesameasthe\n\nluminancecomponentofreversiblecolortransformadoptedby\n\nJPEG2000initslosslessmode.\nTounderstandthephysicalmeaningsofthethreehighsub-\nbands(\n,,and\n)ofamosaicimage,weuseamodel\nofmosaicimagesthatwasoriginallydevelopedforthepurpose\nofcolordemosaicking[2].Inthismodel,aBayermosaicimage\n[seeFig.6(b)]isviewedasasumoftwocomponentimages\nTherstcomponentimage,asshowninFig.6(c),isthefull\nresolutiongreen(anapproximationofluminance)channel.The\n'b'1384IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\nFig.6.MosaicimagemodelandeffectsofwavelettransformonBayermosaicimages.(a)Anoriginalfull-colorimage.(b)Bayerpatternmosaicimageof\n(a).(c)Thegreenchannelof(a).(d)Thecheckerboardcolordifferencesignalof(a).Themid-gray(128)representsvalue0.Notethatimage(b)isthesumo\nfimages\n(c)and(d).(e)One-level2-Dwavelettransformofthegreenchannel(c).(f)One-level2-Dwavelettransformofthecheckerboardcolordifferenceim\nage(d).\n(Colorversionavailableonlineathttp://ieeexplore.ieee.org.)\nothercomponent,asshowninFig.6(d),isacheckerboardsam-\npledcolordifference(arepresentationofchrominance)image\nforodd\nandforeven\nand(5)Aswearguedinthepreceedingsection,thetwocolordiffer-\nenceimages\nandarelow-pass\nsignals,becausenaturalimagesmostlyconsistofpastoral(un-\nsaturated)colorsthathavehighcorrelationbetweenthegreen\n\nandred/bluechannels.Anintegerwavelettransformisapprox-\n\nimatelyalinearoperation,ifweignoretherounding.Applying\nwavelettransformdirectlytoamosaicimageis,thus,equiva-\nlenttoseparatelytransformingthefullresolutiongreenchannel\n\n[resultinginFig.6(e)]andthedownsampledcolordifference\n\nimage[resultinginFig.6(f)],andthensumminguptheresults.\n'b'ZHANGANDWU:LOSSLESSCOMPRESSIONOFCOLORMOSAICIMAGES\n1385(g)(h)Fig.6.(\nContinued.)Mosaicimagemodelandeffectsofwavelettransformon\nBayermosaicimages.(g)One-level2-Dwavelettransformofthemosaicimage\n(b),whichisapproximatelythesumofimages(e)and(f).(h)Two-level2-D\nMallatpacketdecompositionofthemosaicimage(b).\nTheneteffectistheimageinFig.6(g),whosecharacteristicis\nverydifferentfromawavelettransformedgrayscaleimage.\nNow,letusanalyzetheoutcomeofsuchanoperation.Ap-\nplyingthe2-D5-3\nhigh-passlter(6)to,say,position\n,wehave\n(7)Theresulting\nsubbandcanbeviewedasacompositionofa\nluminancecomponentandachrominancecomponent.The\nrstcomponentisthedetailsignaloftheusual\nsubbandofthe\ngreenchannel(luminance).Thesecondcomponentislow-pass\n\nlteredchrominancesignal,inwhichthecolordifferenceimage\nisaveragedverticallyand\naveragedhor-\nizontally.Sincecolordifferenceimages\nandarelow-passed\nsignalsinthe\nrstplace,the5-3high-pass\nlteractually(orquite\ncounterintuitively)makestheir\nresponseevensmoother.\nInotherwords,the5-3high-pass\nlterhastheeffectofspec-\ntraldecorrelation.Asaresult,inthe\nsubbandofaBayer\nmosaicimage[seethe\nsubbandofFig.6(g)],thedetailsof\nthegreenchannel[seethe\nsubbandofFig.6(e)]aresuper-\nimposedonahighlysmoothedcolordifferencesignal[seethe\nsubbandofFig.6(f)].Ifweapplythe5-3integerwavelet\ntransformagainto\nband[seeFig.6(h)]weachievegreater\nenergycompactionbyfurtherseparatingthegreendetailsfrom\n\nthesmoothcolordifferencesignal.\nSimilaranalysiscanbecarriedouton\n/subbands.Ap-\nplyingthe2-D5-3\nhigh-passlter(8)toposition\nyields(9)Likethe\nsubband,the\nsubbandalsoconsistsof\nluminanceandchrominancecomponents.Theluminance\ncomponentisthedetailsignaloftheusual\nsubbandof\nthegreenchannel.Thechrominancecomponentissomewhat\n\nintricate,havingtwosubcomponents:thesmoothedcolor\ndifferencesignal\n(theaverageofafourneighbor\nwindow),andahorizontally\nlteredsignal\nbylter.Intermsofcontributions\ntotheenergyofthe\nsubband,theluminancecomponent\ndominatessincethereisasigni\ncantamountofattenuationto\nthechrominancecomponent.\nThesignalcompositionofthe\nsubbandisanalogousto\nthatofthe\nsubband.Itcontainsdetailsignaloftheusual\nsubbandofthegreenchannel,plusasmoothed\nsignalin\na2-Dwindowandavertically\nlteredsignalusing\n.Theanalysisaboverevealsthatallfoursubbands\n,,,and\ncontainlow-frequencycomponentsofeither\nchrominanceorluminancesignals,asbeingevidentinFig.6(g).\nThenextnaturalstepistodecomposethesefoursubbandsfur-\n\nthertobetterpackthesignalenergy.Theresultingsixteen\n\nsubbandsareshowninFig.6(h).The\nsubbandcontains\ndownsampledluminanceinformation,whiletheenergyofthe\nchrominancesignalsispackedintothe\n,,and\nsubbands.Theothertwelvesubbands,representingthemuchof\n\nimagedetailsinbothluminanceandchrominance,nowbecome\ndiscontinuoussignalsoflowamplitudeverymuchlikethe\n'b'1386IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\nFig.7.WaveletDecompositions.(a)Five-levelofMallatpacket\ndecomposition.(b)Thedecompositionclosestto(a)thatisrealizablebyJPEG\n2000decompositionoptions.\nhigh-frequencywaveletsubbandsofnormalcontinuous-tone\nimages.Therefore,theyshouldnotbedecomposedanyfurther.\n\nBasedontheseobservations,weintroduce,forthepurposeof\nmaximumenergypackingofmosaicimages,aso-calledMallat\npacketdecompositionasdepictedinFig.7(a).Itconsistsofa\n\npacketoffourMallatdecompositionsin\n,,,and\nsubbands,respectively.\nWehavealsoexperimentedwithmanyotherreversiblein-\ntegerwavelet\nltersintheMallatpacketforlosslesscompres-\nsionofcolormosaicimages.Inparticular,wecomparetheen-\n\nergypackingcapabilitiesofthepopular5/3,9/7M,5/11-C[10]\nandthesimplestHaar\nltersonmosaicimages.Toevaluatethese\ninteger\nlterswetabulateinTableIVtheself-entropiesachieved\nbythemafterthe\nve-levelMallatpacketdecomposition.These\nentropyresultsshowthatallintegerwavelets,withexceptionof\nHaarwaveletthatisabout4%worse,performvirtuallythesame.\nFurthermore,weinvestigatedthecombinationofdifferent\nltersatdifferentdecompositionlevelsofMallatpacket.Incolumn\n\nsixofTableIVtheresultsareobtainedbyapplying9/7M\nlterinrstleveldecomposition[Fig.6(g)]andfollowedbythe5/3\nlterintheotherfourlevels[Fig.7(a)].Columnsevenliststhe\nresultsforthecombinationofthe5/11C\nlterin\nrstleveland\nthe5/3\nlterinotherlevels.\nAsforcontinuous-toneimages,thewavelettransformdoes\nnotgeneratei.i.d.coef\ncientsonmosaicimages.Higherlossless\ncompressionofmosaicimagescanbeachievedbycontextmod-\n\nelingandadaptivearithmeticcoding.Wecodethecoef\ncientsofMallatpackettransformusingthehigh-ordercontext-based\nentropycodingtechniqueECECOW[11].Thelosslessbitrates\n\nofdifferentintegerwaveletswhencodedbyECECOWarelisted\n\ninTableV.\nV.F\nASTCONTEXT-BASEDCOEFFICIENTCODINGGiventhecapabilityofintegerwaveletsinpackingenergyof\nmosaicimagesonecancertainlyuseJPEG2000standarddi-\nrectlyforlosslesscodingofmosaicimages,usingtheoptions\n\nof5-3integerwaveletandtheSPACLdecomposition[two-level\n\nSPACLisequivalenttowaveletpacketinFig.6(h)].However,\nJPEG2000isnotthebestsolutionforthisapplicationinterms\nofeithercompressionperformanceorlowcomplexity.Ithas\n\ntwodisadvantages.First,JPEG2000doesnotsupportMallat\n\npacket[Fig.7(a)]asweproposedintheproceedingsection.\nTheclosetdecompositionthatcanberealizedbyJPEG2000\nTABLEIV\nSELF-ENTROPYOF\nWAVELET\nCOEFFICIENTSOFTHE\nFIVE-LEVELMALLAT\nPACKET\nDECOMPOSITIONFOR\nDIFFERENTWAVELET\nFILTERSON\nMOSAICIMAGES\nTABLEV\nLOSSLESSBITRATESOF\nMOSAICIMAGESBY\nECECOW\nFORDIFFERENTINTEGERWAVELET\nTRANSFORMSVM8.0istheoneshowninFig.7(b),whichisobtainedbyrather\ntediousdecompositionoptionsetting\n-Fdecomp31-Fgen_de-\ncomp11100011000110001.\nSecond,andmoreimportantly,theentropycodingmoduleof\nJPEG2000isnotsuitableforMallatpacket.Thethreesubbands\nshadedinFig.7(b)ofBayerpatternmosaicimagestendtobe\nsmooth,notlikethe\n,,and\nsubbandsoffull-res-\nolutioncontinuous-toneimages.Thispropertymakesthecon-\n\ntextmodelofEBCOT[12]forhigh-frequencysubbandsineffec-\ntive.Furthermore,theentropycodingtechniqueofJPEG2000\niscomputationallyexpensive.\nAimingforon-camerareal-timelosslessencodingofmosaic\nimagesatlowercomputationalcomplexity,weproposeamuch\nsimplerandhardware-orientedentropycodingsolution.Ourde-\nsigngoalistomeettherequirementsoflowcost,longerbat-\n\nterylife(requiringlow-powerconsumption)andshortshutter\n\nlag(requiringhigh-codecthroughput),whicharehighlydesir-\nablefeaturesofdigitalcameras.\nFirst,considerentropycodingofthetwelvehigh-frequency\nsubbandsgeneratedbythe2-Dtwo-levelMallatpackettrans-\n\nform.Sincetheliftingschemeoftheintegerwaveletessentially\nperformslinearpredictionoperationsonpixels[13],thewavelet\ncoefcientsinthehigh-frequencysubbandscanbeviewedas\npredictionresiduals.Itiswellknowninsignalcompression\n\nthatthedistributionofpredictionerrorsisapproximately\nLaplacian.Thisfactandourabove-mentioneddesignobjective\nmakeGolombcodeanaturalchoicefortheentropycoding\n\nofhigh-frequencysubbands.TheGolombcodeisalow-com-\n\nplexityadaptiveentropycodingtechniqueandisyetoptimal\nforgeometricaldistribution[14].\nTheGolombcodeoperatesonrandomvariablesofpositive\nintegervalues.Apositiveinteger\niscodedintwoparts:The\nquotientandtheremainder\n,where\nistheso-calledGolombparameterwhichisitselfalsoapositive\n'b'ZHANGANDWU:LOSSLESSCOMPRESSIONOFCOLORMOSAICIMAGES\n1387integer.Thecodestreamof\nistheconcatenationoftheunary\ncodeof\nandthebinarycodeof\n.Obviously,theGolombpa-\nrameterdeterminesthecodelengthof\n.TheGolombcode\naffordsaverysimpleimplementationifitsparameterisanin-\ntegerpoweroftwo,\n,.Inthiscase,thecodeof\nhasaquotientpartthatisgeneratedbysimplyright-shifting\nbybits,andtheremainderisjustthe\nleastsigni\ncantbitsof\n.ThisspecialformofGolombcodeisalsoknownastheRice\ncode.Next,wedevelopasimplecontext-basedRicecodingscheme\ntocompressintegerwaveletcoef\ncients.Coef\ncientsineach\nsubbandarecodedinrasterscanorderfromlefttorightand\ntoptobottom.Awaveletcoef\ncientissplitintoitssignand\nmagnitude.Thesignof\niskeptuncodedand\nisrep-\nresentedinRicecode.ThekeytotheperformanceofRicecode\nisthechoiceoftheparameter\n.The\nexibilityofchangingthe\nvalueof\npersourcesymbolonthe\nymakesRicecodeadap-\ntivetothechangingstatisticsoftheinputsignal.Speci\ncallyforlosslesswaveletcompressionofmosaicimages,thewavelet\ncoefcientsarenoti.i.d.becausewavelettransformclustersco-\nefcientsinthespatialdomainbymagnitudes.Itcanbereadily\nobservedfromFig.6(h)thatlargewaveletcoef\ncientstendto\noccurinvicinityofedges,andconverselysmallcoef\ncientsformlargecontiguousblocks.Toexploitthismemorystructure\nofthesource,weassociatethecurrentwaveletcoef\ncient,whichistherandomvariabletobecoded,withthe\n-shapedneighborhoodorcontextof\n:andwede\nnetheenergyoftheneighborhoodby\n(10)Denoteby\ntheRicecodelengthgivencontext\nandparameter.HavingchosentheRicecodeforitsoperational\nadvantage,westillhavetheroomtooptimize\nwithrespectto\ncontext\ntominimizethecodelength\n.Theunder-\nlyingoptimizationproblemistodeterminetheoptimalvalueof\n(11)Notethat\nincreasesinthevarianceof\n,if\nisdrawnfrom\naprocess,whichisstationary,zero-mean,andofunimodal\n\nmarginaldistributioninthewindowofthecontext\n.Thisisthe\ncaseforhigh-frequencywaveletcoef\ncientswhosedistribution\nisknowntobeLaplacian.Consequently,\nismonotonically\nnondecreasingin\n.SincetheRiceparameterhasinteger\nvalues,thedistinctvaluesof\npartitiontheintervalofthe\nvaluesintocontiguoussubintervals.Thispropertyreducesthe\noptimizationproblemof(9)tothefollowingoptimalscalar\ncontextquantizationproblem:\n(12)whereisascalarquantizerofrandomvariable\nandisthemaximumnumberofRiceparameterstobeused.Thede-\n\nsignoftheoptimalcontextquantizer\ncanbedoneviady-\nnamicprogramming[15].Althoughitispossibletocompute\ntheimage-dependentoptimalcontextquantizer\ntominimize\ntheRicecodelengthforaninputimage,thisapproachisclearly\n\nimpracticalformostdigitalcameraapplications.However,one\ncancompute\ninanof\ninedesignprocessusingatrainingset\nthatprovidessamplestatisticsofthejointdistributionof\n.Thetrainingset(s)shouldbechosenforgivenintegerwavelet\n\ntransform,givenCCDsensor,andmayalsobewithrespectto\ndifferenttypesofscenes,butwefoundempiricallythatthefol-\nlowingsimplepartitionof\n(13)workswellon8-bitmosaicimages(withinlessthan2%from\ntheminimumRicecodelengthachievedby\ncomputedbydy-\nnamicprogramming).\nForthefoursmoothsubbands:\n,,,and\n,asimpleDPCMcodingisemployed\nrst.Forcurrentcoef\ncientatposition\n,alinearpredictionisperformedas\n(14)Afterprediction,thepredictionresidual\nistreatedthesame\nasthosecoef\ncientsinhighsubbands.The\nismappedfrom\nsignedintegerintono-negativeinteger\nby(15)Asimplecontextforcurrentvalue\nisformedas\n(16)Thecontextvalue\nisquantizedbypresetthresholdstodeter-\nminetheGolomb\nRicevariable\nfor(17)VI.E\nXPERIMENTAL\nRESULTS\nWeimplementedthesimpleentropycodingtechniquede-\nscribedaboveandevaluateditsperformancewhencoupled\nwiththe5-3integerwavelet.Inourexperiments,wesimulated\n\ncolormosaicimagesbysubsamplingsometypicalcolorimages\n\ndrawnfromtheISOJPEGtestset[Woman,Bike(2048\n2560)]andtheKodakset(768\n512)[someexamplesare\ngiveninFig.1(b)],andinterleavingthesamplesaccordingto\n\ntheBayerpattern.\nTableVIpresentsthelosslessbitratesoftheproposed\nmethodincomparisonwithJPEG-LSandthelosslessmode\nofJPEG2000whenapplieddirectlytorawmosaicimagesof\n\nBayerpattern.JPEG2000wastestedfordifferentdecompo-\n\nsitionschemes:defaultMallat,SPACL,Hybrid[asshownin\nFig.7(b)],andthecorrespondingresultsarelistedinTableVI\n(columnsthreeto\nve).Theproposedmethod,despiteits\n'b'1388IEEETRANSACTIONSONIMAGEPROCESSING,VOL.15,NO.6,JUNE2006\nTABLEVI\nLOSSLESSBITRATESOF\nMOSAICIMAGESBY\nJPEG-LS,JPEG2000,\nANDPROPOSED\nMETHODsimplicity,outperformsallothermethodsoneverysingletest\nimage.Notethattheaveragebitrateoftheproposedinterleaved\ncompressionmethodisalsolowerthanthebestde-interleaved\n\ncodingresultsofJPEG-LSinTableIII,althoughJPEG-LSuses\non-linecontextmodelingtechniquesofhighercomplexity.\nComparingTablesVandVI,weseethattheperformancegap\nbetweenthesimpleRicecodeandcomputationallyintensive\nECECOWtechniqueisonlyabout2%,whiletheformerismore\nthansixtimesfasterthanthelatter.Theencoderanddecoder\n\nthroughputsoftheproposedmethodaremorethanfourtimes\n\nhigherthanJPEG2000and90%higherthanJPEG-LS.\nVII.C\nONCLUSIONVarioustechniquesforlosslesscodingofrawcolormosaic\nimagesgeneratedbyCCDcamerasofBayerpatternwereinves-\n\ntigated.Itturnedoutthattheintegerwavelettransformisideally\n\nsuitedtothetask,byofferingef\ncientenergypackinginboth\nimageandcolorspaces.Afastandpracticalcodecforlossless\ncompressionofmosaicimageswasdeveloped.\nJPEG2000standard(initslosslessmode)canbeconve-\nnientlyappliedtolosslesscompressionofcolormosaicimages.\nAsasimplerandfasteralternativewehavealsodevelopeda\nlosslessmosaicimagecodecbasedonintegerMallatpacket\n\ntransformandRicecode.ThiscodecoutperformsJPEG2000\n\nandJPEG-LSinbothbitrateandspeed.\nREFERENCES[1]B.Bayer,\nColorImagingArray,\nU.S.Patent3971065.\n[2]X.WuandN.Zhang,\nPrimary-consistentsoft-decisioncolordemo-\nsaickingfordigitalcameras,\nIEEETrans.ImageProcess.\n,vol.13,no.\n9,pp.1263\n1274,Sep.2004.\n[3]K.Hisakazu,M.Shogo,T.Ishida,andT.Kuge,\nReversibleconversion\nbetweeninterlacedandprogressivescanformatsanditsef\ncientimple-\nmentation,presentedattheEUSIPCOConf.,Sep.2002,Paper448.\n[4]C.C.KohandS.K.Mitra,\nCompressionofBayercolor\nlterarray\ndata,inProc.Int.Conf.ImageProcessing\n,vol.2,Barcelona,Spain,\nSept.2003,pp.255\n258.[5]InformationTechnologyLosslessandNear-LosslessCompressionof\nContinuous-ToneStillImages\n,ISOFDIS14495-1(JPEG-LS),1998.\n[6]JPEG2000PartIFinalDraftInternationalStandard\n,2000.\n[7]D.R.Cok,\nSignalProcessingMethodandApparatusforSampled\nImageSignals,\nU.S.Patent4630307,1987.\n[8]R.H.Hibbard,\nApparatusandMethodforAdaptivelyInterpolating\naFullColorImageUtilizingLuminanceGradients,\nU.S.Patent\n5382976,1995.\n[9]O.RashkovskiyandW.Macy,\nMethodofDeterminingMissingColor\nValuesforPixelsinaColorFilterSrray,\nU.S.Patent6181376,2001.\n[10]M.D.Adams,\nReversibleinteger-to-integerwavelettransformsfor\nimagecompression:performanceevaluationandanalysis,\nIEEETrans.\nImageProcess.\n,vol.9,no.6,pp.1010\n1024,Jun.2000.\n[11]X.Wu,\nHigh-ordercontextmodelingandembeddedconditionalen-\ntropycodingofwaveletcoef\ncientsforimagecompression,\ninProc.\n31stAsilomarConf.Signals,System,andComputers\n,Nov.1997,pp.\n13781382.[12]D.Taubman,\nHighPerformanceScalableImageCompressionWidth\nEBCOT,\nIEEETrans.ImageProcess.\n,vol.9,no.7,pp.1158\n1170,Jul.2000.\n[13]A.SaidandW.A.Pearlman,\nAnimagemultiresolutionrepresentation\nforlosslessandlossycompression,\nIEEETrans.ImageProcess.\n,vol.\n5,no.9,pp.1303\n1310,Sep.1996.\n[14]R.G.GallagerandD.C.VanVoorhis,\nOptimalsourcecodeforgeo-\nmetricallydistributedintegeralphabets,\nIEEETrans.Inf.Theory\n,vol.\nIT-21,no.3,pp.228\n230,Mar.1975.\n[15]N.ZhangandX.Wu,\nLosslessCompressionofColorMosaicImages,\npresentedattheInt.Conf.ImageProcessing,Singapore,2004.\nNingZhang\nreceivedtheB.E.andPh.D.degreesin\nelectricalengineeringfromTsinghuaUniversity,Bei-\njing,China,in1994and2000,respectively.\nHeiscurrentlyaResearchAssociatewithMc-\nMasterUniversity,Hamilton,ON,Canada.His\n\nresearchinterestsincludedatacompression,image\nprocessing,multimediacommunication,anddigital\ncinema.XiaolinWu\n(M88SM96)receivedtheB.Sc.degreefromWuhanUniversity,\nChina,in1982,andthePh.D.degreefromtheUniversityofCalgary,Calgary,\nAB,Canada,in1988,bothincomputerscience.\nHeiscurrentlyaProfessorwiththeDepartmentofElectricalandComputer\nEngineering,McMasterUniversity,ON,Canada,whereheholdstheNSERC-\n\nDALSAResearchChairinDigitalCinema.Hisresearchinterestsincludemul-\ntimediacodingandcommunications,imageprocessing,signalquantizationand\ncompression,andjointsource-channelcoding.Hehaspublishedover160re-\nsearchpapersandholdstwopatentsinthese\nelds.Dr.Wureceivedthe2003NokiaVisitingFellowship,the2000MonstedsFel-\nlowship,andthe1998UWODistinguishedResearchProfessorship\n'
b'InternationalJournalofComputerVision59(2),167181,2004\nc2004KluwerAcademicPublishers.ManufacturedinTheNetherlands.\nEfcientGraph-BasedImageSegmentation\nPEDROF.FELZENSZWALB\nArticialIntelligenceLab,MassachusettsInstituteofTechnology\npff@ai.mit.edu\nDANIELP.HUTTENLOCHER\nComputerScienceDepartment,CornellUniversity\ndph@cs.cornell.eduReceivedSeptember24,1999;RevisedAugust26,2003;AcceptedSeptember17,2003\nAbstract.Thispaperaddressestheproblemofsegmentinganimageintoregions.Wedeneapredicatefor\nmeasuringtheevidenceforaboundarybetweentworegionsusingagraph-basedrepresentationoftheimage.We\n\nthendevelopanefcientsegmentationalgorithmbasedonthispredicate,andshowthatalthoughthisalgorithm\n\nmakesgreedydecisionsitproducessegmentationsthatsatisfyglobalproperties.Weapplythealgorithmtoimage\n\nsegmentationusingtwodifferentkindsoflocalneighborhoodsinconstructingthegraph,andillustratetheresults\n\nwithbothrealandsyntheticimages.Thealgorithmrunsintimenearlylinearinthenumberofgraphedgesand\n\nisalsofastinpractice.Animportantcharacteristicofthemethodisitsabilitytopreservedetailinlow-variability\n\nimageregionswhileignoringdetailinhigh-variabilityregions.\nKeywords:\nimagesegmentation,clustering,perceptualorganization,graphalgorithm\n1.Introduction\nTheproblemsofimagesegmentationandgroupingre-\nmaingreatchallengesforcomputervision.Sincethe\n\ntimeoftheGestaltmovementinpsychology(e.g.,\n\nWertheimer,1938),ithasbeenknownthatperceptual\ngroupingplaysapowerfulroleinhumanvisualpercep-\n\ntion.Awiderangeofcomputationalvisionproblems\n\ncouldinprinciplemakegooduseofsegmentedimages,\n\nweresuchsegmentationsreliablyandefcientlycom-\n\nputable.Forinstanceintermediate-levelvisionprob-\n\nlemssuchasstereoandmotionestimationrequirean\n\nappropriateregionofsupportforcorrespondenceoper-\n\nations.Spatiallynon-uniformregionsofsupportcanbe\n\nidentiedusingsegmentationtechniques.Higher-level\n\nproblemssuchasrecognitionandimageindexingcan\n\nalsomakeuseofsegmentationresultsinmatching,to\n\naddressproblemssuchasgure-groundseparationand\n\nrecognitionbyparts.\nOurgoalistodevelopcomputationalapproachesto\nimagesegmentationthatarebroadlyuseful,muchin\n\nthewaythatotherlow-leveltechniquessuchasedge\n\ndetectionareusedinawiderangeofcomputervision\n\ntasks.Inordertoachievesuchbroadutility,webelieve\n\nitisimportantthatasegmentationmethodhavethe\n\nfollowingproperties:\n1.Captureperceptuallyimportantgroupingsorre-\ngions,whichoftenreectglobalaspectsoftheim-\n\nage.Twocentralissuesaretoprovideprecisechar-\nacterizationsofwhatisperceptuallyimportant,and\n\ntobeabletospecifywhatagivensegmentationtech-\n\nniquedoes.Webelievethatthereshouldbepre-\n\ncisedenitionsofthepropertiesofaresultingseg-\n\nmentation,inordertobetterunderstandthemethod\n\naswellastofacilitatethecomparisonofdifferent\n\napproaches.'b'168FelzenszwalbandHuttenlocher\n2.Behighlyefcient,runningintimenearlylinear\ninthenumberofimagepixels.\nInordertobeof\npracticaluse,webelievethatsegmentationmeth-\n\nodsshouldrunatspeedssimilartoedgedetectionor\n\notherlow-levelvisualprocessingtechniques,mean-\n\ningnearlylineartimeandwithlowconstantfactors.\n\nForexample,asegmentationtechniquethatrunsat\nseveralframespersecondcanbeusedinvideopro-\n\ncessingapplications.\nWhilethepastfewyearshaveseenconsiderable\nprogressineigenvector-basedmethodsofimageseg-\n\nmentation(e.g.,ShiandMalik,1997;Weiss,1999),\n\nthesemethodsaretooslowtobepracticalformany\n\napplications.Incontrast,themethoddescribedinthis\n\npaperhasbeenusedinlarge-scaleimagedatabaseap-\n\nplicationsasdescribedinRatanetal.(1999).While\n\nthereareotherapproachestoimagesegmentationthat\n\narehighlyefcient,thesemethodsgenerallyfailtocap-\n\ntureperceptuallyimportantnon-localpropertiesofan\n\nimageasdiscussedbelow.Thesegmentationtechnique\n\ndevelopedherebothcapturescertainperceptuallyim-\n\nportantnon-localimagecharacteristicsandiscompu-\n\ntationallyefcientrunningin\nO(nlogn)timefor\nnimagepixelsandwithlowconstantfactors,andcanrun\n\ninpracticeatvideorates.\nFigure1\n.Asyntheticimagewiththreeperceptuallydistinctregions,andthethreelargestregionsfoundbyoursegmentationmethod(image\n320240pixels;algorithmparameters\n=0.8,k=300,seeSection5foranexplanationoftheparameters).\nAswithcertainclassicalclusteringmethods\n(Urquhart,1982;Zahn,1971),ourmethodisbasedon\n\nselectingedgesfromagraph,whereeachpixelcorre-\n\nspondstoanodeinthegraph,andcertainneighboring\n\npixelsareconnectedbyundirectededges.Weightson\n\neachedgemeasurethedissimilaritybetweenpixels.\n\nHowever,unliketheclassicalmethods,ourtechnique\n\nadaptivelyadjuststhesegmentationcriterionbasedon\n\nthedegreeofvariabilityinneighboringregionsofthe\n\nimage.Thisresultsinamethodthat,whilemaking\n\ngreedydecisions,canbeshowntoobeycertainnon-\n\nobviousglobalproperties.Wealsoshowthatother\n\nadaptivecriteria,closelyrelatedtotheonedeveloped\n\nhere,resultinproblemsthatarecomputationallydif-\n\ncult(NPhard).\nWenowturntoasimplesyntheticexampleillustrat-\ningsomeofthenon-localimagecharacteristicscap-\n\nturedbyoursegmentationmethod.Considertheimage\n\nshowninthetopleftofFig.1.Mostpeoplewillsay\n\nthatthisimagehasthreedistinctregions:arectangular-\n\nshapedintensityrampinthelefthalf,aconstantin-\n\ntensityregionwithaholeontherighthalf,anda\n\nhigh-variabilityrectangularregioninsidetheconstant\n\nregion.Thisexampleillustratessomeperceptuallyim-\n\nportantpropertiesthatwebelieveshouldbecapturedby\n\nasegmentationalgorithm.First,widelyvaryingintensi-\ntiesshouldnotalonebejudgedasevidenceformultiple\n'b'EfcientGraph-BasedImageSegmentation169\nregions.Suchwidevariationinintensitiesoccursboth\nintherampontheleftandinthehighvariabilityre-\n\ngionontheright.Thusitisnotadequatetoassume\n\nthatregionshavenearlyconstantorslowlyvarying\n\nintensities.Asecondperceptuallyimportantaspectoftheexam-\npleinFig.1isthatthethreeregionscannotbeobtained\n\nusingpurelylocaldecisioncriteria.Thisisbecausethe\n\nintensitydifferenceacrosstheboundarybetweenthe\n\nrampandtheconstantregionisactuallysmallerthan\n\nmanyoftheintensitydifferenceswithinthehighvari-\n\nabilityregion.Thus,inordertosegmentsuchanimage,\n\nsomekindofadaptiveornon-localcriterionmustbe\n\nused.ThemethodthatweintroduceinSection3.1mea-\nsurestheevidenceforaboundarybetweentworegions\n\nbycomparingtwoquantities:onebasedonintensity\n\ndifferencesacrosstheboundary,andtheotherbased\n\nonintensitydifferencesbetweenneighboringpixels\n\nwithineachregion.Intuitively,theintensitydifferences\n\nacrosstheboundaryoftworegionsareperceptually\n\nimportantiftheyarelargerelativetotheintensitydif-\n\nferencesinsideatleastoneoftheregions.Wedevelop\n\nasimplealgorithmwhichcomputessegmentationsus-\ningthisidea.TheremainingpartsofFig.1showthe\n\nthreelargestregionsfoundbyouralgorithm.Although\n\nthismethodmakesgreedydecisions,itproducesre-\n\nsultsthatcapturecertainglobalpropertieswhichare\n\nderivedbelowandwhoseconsequencesareillustrated\n\nbytheexampleinFig.1.Themethodalsorunsina\n\nsmallfractionofasecondforthe320\n240imagein\ntheexample.\nTheorganizationofthispaperisasfollows.Inthe\nnextSectionwediscusssomerelatedwork,includ-\n\ningbothclassicalformulationsofsegmentationand\n\nrecentgraph-basedmethods.InSection3weconsider\n\naparticulargraph-basedformulationofthesegmenta-\ntionproblemanddeneapairwiseregioncomparison\n\npredicate.TheninSection4wepresentanalgorithm\n\nforefcientlysegmentinganimageusingthispredi-\n\ncate,andderivesomeglobalpropertiesthatitobeys\n\neventhoughitisagreedyalgorithm.InSection5we\nshowresultsforanumberofimagesusingtheimage\n\ngridtoconstructagraph-basedrepresentationofthe\n\nimagedata.TheninSection6weillustratethemethod\n\nusingmoregeneralgraphs,butwherethenumberof\n\nedgesisstilllinearinthenumberofpixels.Usingthis\n\nlatterapproachyieldsresultsthatcapturehigh-level\n\nscenepropertiessuchasextractingaowerbedasa\n\nsingleregion,whilestillpreservingnedetailinother\nportionsoftheimage.IntheAppendixweshowthata\nstraightforwardgeneralizationoftheregioncompari-\n\nsonpredicatepresentedinSection3makestheproblem\n\nofndingagoodsegmentationNP-hard.\n2.RelatedWork\nThereisalargeliteratureonsegmentationandclus-\ntering,datingbackover30years,withapplicationsin\n\nmanyareasotherthancomputervision(cf.Jainand\n\nDubes,1988).Inthissectionwebrieyconsidersome\n\noftherelatedworkthatismostrelevanttoourapproach:\n\nearlygraph-basedmethods(e.g.,Urquhart,1982;Zahn,\n\n1971),regionmergingtechniques(e.g.,Cooper,1998;\n\nPavlidas,1977),techniquesbasedonmappingimage\npixelstosomefeaturespace(e.g.,ComaniciuandMeer,\n\n1997,1999)andmorerecentformulationsintermsof\n\ngraphcuts(e.g.,ShiandMalik,1997;WuandLeahy,\n\n1993)andspectralmethods(e.g.,Weiss,1999).\nGraph-basedimagesegmentationtechniquesgener-\nallyrepresenttheproblemintermsofagraph\nG=(V,E)whereeachnode\nviVcorrespondstoapixel\nintheimage,andanedge(\nvi,vj)Econnectsvertices\nviandvj.Aweightisassociatedwitheachedgebased\nonsomepropertyofthepixelsthatitconnects,such\n\nastheirimageintensities.Dependingonthemethod,\n\ntheremayormaynotbeanedgeconnectingeachpair\n\nofvertices.Theearliestgraph-basedmethodsusexed\n\nthresholdsandlocalmeasuresincomputingasegmen-\n\ntation.TheworkofZahn(1971)presentsasegmen-\n\ntationmethodbasedontheminimumspanningtree\n\n(MST)ofthegraph.Thismethodhasbeenapplied\n\nbothtopointclusteringandtoimagesegmentation.\n\nForimagesegmentationtheedgeweightsinthegraph\narebasedonthedifferencesbetweenpixelintensities,\n\nwhereasforpointclusteringtheweightsarebasedon\n\ndistancesbetweenpoints.\nThesegmentationcriterioninZahnsmethodis\ntobreakMSTedgeswithlargeweights.Theinade-\n\nquacyofsimplybreakinglargeedges,however,isil-\n\nlustratedbytheexampleinFig.1.Asmentionedin\n\ntheintroduction,differencesbetweenpixelswithinthe\n\nhighvariabilityregioncanbelargerthanthosebe-\n\ntweentherampandtheconstantregion.Thus,de-\n\npendingonthethreshold,simplybreakinglargeweight\n\nedgeswouldeitherresultinthehighvariabilityre-\n\ngionbeingsplitintomultipleregions,orwouldmerge\n\ntherampandtheconstantregiontogether.Thealgo-\n\nrithmproposedbyUrquhart(1982)attemptstoaddress\n'b'170FelzenszwalbandHuttenlocher\nthisshortcomingbynormalizingtheweightofanedge\nusingthesmallestweightincidentontheverticestouch-\n\ningthatedge.Whenappliedtoimagesegmentation\n\nproblems,however,thisisnotenoughtoprovidearea-\n\nsonableadaptivesegmentationcriterion.Forexample,\n\nmanypixelsinthehighvariabilityregionofFig.1have\n\nsomeneighborthatishighlysimilar.\nAnotherearlyapproachtoimagesegmentationis\nthatofsplittingandmergingregionsaccordingtohow\n\nwelleachregiontssomeuniformitycriterion(e.g.,\n\nCooper,1998;Pavlidas,1977).Generallytheseunifor-\n\nmitycriteriaobeyasubsetproperty,suchthatwhena\n\nuniformitypredicate\nU(A)istrueforsomeregion\nAthenU(B)isalsotrueforany\nBA.Usuallysuch\ncriteriaareaimedatndingeitheruniformintensity\n\noruniformgradientregions.Noregionuniformitycri-\n\nterionthathasbeenproposedtodatecouldbeused\n\ntocorrectlysegmenttheexampleinFig.1,duetothe\n\nhighvariationregion.Eitherthisregionwouldbesplit\n\nintopieces,oritwouldbemergedwiththesurrounding\n\narea.Anumberofapproachestosegmentationarebased\nonndingcompactclustersinsomefeaturespace(cf.\n\nComaniciuandMeer,1997;JainandDubes,1988).\n\nTheseapproachesgenerallyassumethattheimageis\n\npiecewiseconstant,becausesearchingforpixelsthat\n\nareallclosetogetherinsomefeaturespaceimplicitly\n\nrequiresthatthepixelsbealike(e.g.,similarcolor).\n\nArecenttechniqueusingfeaturespaceclustering\n(ComaniciuandMeer,1999)rsttransformsthedata\n\nbysmoothingitinawaythatpreservesboundariesbe-\n\ntweenregions.Thissmoothingoperationhastheover-\n\nalleffectofbringingpointsinaclusterclosertogether.\n\nThemethodthenndsclustersbydilatingeachpoint\n\nwithahypersphereofsomexedradius,andnding\n\nconnectedcomponentsofthedilatedpoints.Thistech-\n\nniqueforndingclustersdoesnotrequireallthepoints\n\ninaclustertoliewithinanyxeddistance.Thetech-\n\nniqueisactuallycloselyrelatedtotheregioncompar-\n\nisonpredicatethatweintroduceinSection3.1,which\n\ncanbeviewedasanadaptivewayofselectinganap-\n\npropriatedilationradius.Wereturntothisissuein\n\nSection6.\nFinallywebrieyconsideraclassofsegmentation\nmethodsbasedonndingminimumcutsinagraph,\n\nwherethecutcriterionisdesignedinordertomini-\n\nmizethesimilaritybetweenpixelsthatarebeingsplit.\n\nWorkbyWuandLeahy(1993)introducedsuchacut\ncriterion,butitwasbiasedtowardndingsmallcom-\n\nponents.Thisbiaswasaddressedwiththe\nnormalizedcutcriteriondevelopedbyShiandMalik(1997),which\ntakesintoaccountself-similarityofregions.Thesecut-\n\nbasedapproachestosegmentationcapturenon-local\n\npropertiesoftheimage,incontrastwiththeearly\n\ngraph-basedmethods.However,theyprovideonlya\n\ncharacterizationofeachcutratherthanofthenal\n\nsegmentation.\nThenormalizedcutcriterionprovidesasignicant\nadvanceoverthepreviousworkinWuandLeahy\n\n(1993),bothfromatheoreticalandpracticalpointof\n\nview(theresultingsegmentationscaptureintuitively\n\nsalientpartsofanimage).However,thenormalized\n\ncutcriterionalsoyieldsanNP-hardcomputational\n\nproblem.WhileShiandMalikdevelopapproxima-\n\ntionmethodsforcomputingtheminimumnormalized\n\ncut,theerrorintheseapproximationsisnotwellun-\n\nderstood.Inpracticetheseapproximationsarestill\n\nfairlyhardtocompute,limitingthemethodtorel-\nativelysmallimagesorrequiringcomputationtimes\n\nofseveralminutes.RecentlyWeiss(1999)hasshown\n\nhowtheeigenvector-basedapproximationsdeveloped\n\nbyShiandMalikrelatetomorestandardspectralparti-\n\ntioningmethodsongraphs.However,allsuchmethods\n\naretooslowformanypracticalapplications.\nAnalternativetothegraphcutapproachistolook\nforcyclesinagraphembeddedintheimageplane.For\n\nexampleinJermynandIshikawa(2001)thequalityof\neachcycleisnormalizedinawaythatiscloselyrelated\n\ntothenormalizedcutsapproach.\n3.Graph-BasedSegmentation\nWetakeagraph-basedapproachtosegmentation.Let\nG=(V,E)beanundirectedgraphwithvertices\nvV,thesetofelementstobesegmented,andedges\n(vi,vj)Ecorrespondingtopairsofneighboring\nvertices.Eachedge(\nvi,vj)Ehasacorresponding\nweightw(vi,vj),whichisanon-negativemeasureof\nthedissimilaritybetweenneighboringelements\nviandvj.Inthecaseofimagesegmentation,theelementsin\nVarepixelsandtheweightofanedgeissomemea-\nsureofthedissimilaritybetweenthetwopixelscon-\n\nnectedbythatedge(e.g.,thedifferenceinintensity,\n\ncolor,motion,locationorsomeotherlocalattribute).\n\nInSections5and6weconsiderparticularedgesetsand\n\nweightfunctionsforimagesegmentation.However,the\n\nformulationhereisindependentofthesedenitions.\nInthegraph-basedapproach,asegmentation\nSisapartitionof\nVintocomponentssuchthateach\n'b'EfcientGraph-BasedImageSegmentation171\ncomponent(orregion)\nCScorrespondstoacon-\nnectedcomponentinagraph\nG=(V,E),where\nEE.Inotherwords,anysegmentationisinduced\nbyasubsetoftheedgesin\nE.Therearedifferentways\ntomeasurethequalityofasegmentationbutingeneral\n\nwewanttheelementsinacomponenttobesimilar,\n\nandelementsindifferentcomponentstobedissimi-\n\nlar.Thismeansthatedgesbetweentwoverticesinthe\n\nsamecomponentshouldhaverelativelylowweights,\n\nandedgesbetweenverticesindifferentcomponents\n\nshouldhavehigherweights.\n3.1.PairwiseRegionComparisonPredicate\nInthissectionwedeneapredicate,\nD,forevaluating\nwhetherornotthereisevidenceforaboundarybe-\n\ntweentwocomponentsinasegmentation(tworegions\n\nofanimage).Thispredicateisbasedonmeasuringthe\n\ndissimilaritybetweenelementsalongtheboundaryof\n\nthetwocomponentsrelativetoameasureofthedissim-\n\nilarityamongneighboringelementswithineachofthe\n\ntwocomponents.Theresultingpredicatecomparesthe\n\ninter-componentdifferencestothewithincomponent\n\ndifferencesandistherebyadaptivewithrespecttothe\n\nlocalcharacteristicsofthedata.\nWedenethe\ninternaldifference\nofacomponent\nCVtobethelargestweightintheminimumspan-\nningtreeofthecomponent,\nMST(C,E).Thatis,\nInt(C)=maxeMST(C,E)w(e).(1)Oneintuitionunderlyingthismeasureisthatagiven\ncomponentConlyremainsconnectedwhenedgesof\nweightatleast\nInt(C)areconsidered.\nWedenethe\ndifferencebetween\ntwocomponents\nC1,C2Vtobetheminimumweightedgeconnect-\ningthetwocomponents.Thatis,\nDif(C1,C2)=minviC1,vjC2,(vi,vj)Ew(vi,vj).(2)Ifthereisnoedgeconnecting\nC1andC2welet\nDif(C1,C2).Thismeasureofdifferencecould\ninprinciplebeproblematic,becauseitreectsonly\n\nthesmallestedgeweightbetweentwocomponents.In\npracticewehavefoundthatthemeasureworksquite\n\nwellinspiteofthisapparentlimitation.Moreover,\n\nchangingthedenitiontousethemedianweight,or\n\nsomeotherquantile,inordertomakeitmorerobustto\n\noutliers,makestheproblemofndingagoodsegmen-\ntationNP-hard,asdiscussedintheAppendix.Thus\nasmallchangetothesegmentationcriterionvastly\nchangesthedifcultyoftheproblem.\nTheregioncomparisonpredicateevaluatesifthere\nisevidenceforaboundarybetweenapairorcompo-\n\nnentsbycheckingifthedifferencebetweenthecompo-\n\nnents,Dif(C1,C2),islargerelativetotheinternaldif-\nferencewithinatleastoneofthecomponents,\nInt(C1)andInt(C2).Athresholdfunctionisusedtocontrolthe\ndegreetowhichthedifferencebetweencomponents\n\nmustbelargerthanminimuminternaldifference.We\n\ndenethepairwisecomparisonpredicate\nD(C1,C2),asD(C1,C2)=trueif\nDif(C1,C2)>MInt(C1,C2)falseotherwise\n(3)wheretheminimuminternaldifference,\nMInt,is\nde-nedas,\nMInt(C1,C2)=min(Int(C1)+(C1),Int(C2)+(C2)).(4)Thethresholdfunction\ncontrolsthedegreetowhich\nthedifferencebetweentwocomponentsmustbegreater\n\nthantheirinternaldifferencesinorderfortheretobe\n\nevidenceofaboundarybetweenthem(\nDtobetrue).\nForsmallcomponents,\nInt(C)isnotagoodestimate\nofthelocalcharacteristicsofthedata.Intheextreme\n\ncase,when\n|C|=1,Int(C)=0.Therefore,weusea\nthresholdfunctionbasedonthesizeofthecomponent,\n(C)=k/|C|(5)where|C|denotesthesizeof\nC,andkissomeconstant\nparameter.Thatis,forsmallcomponentswerequire\n\nstrongerevidenceforaboundary.Inpractice\nksetsa\nscaleofobservation,inthatalarger\nkcausesapref-\nerenceforlargercomponents.Note,however,that\nkisnotaminimumcomponentsize.Smallercomponents\n\nareallowedwhenthereisasufcientlylargedifference\n\nbetweenneighboringcomponents.\nAnynon-negativefunctionofasinglecomponent\ncanbeusedfor\nwithoutchangingthealgorithmic\nresultsinSection4.Forinstance,itispossibletohave\n\nthesegmentationmethodprefercomponentsofcertain\n\nshapes,bydeninga\nwhichislargeforcomponents\nthatdonottsomedesiredshapeandsmallforones\n\nthatdo.Thiswouldcausethesegmentationalgorithm\n'b'172FelzenszwalbandHuttenlocher\ntoaggressivelymergecomponentsthatarenotofthe\ndesiredshape.Suchashapepreferencecouldbeas\n\nweakaspreferringcomponentsthatarenotlongand\n\nthin(e.g.,usingaratioofperimetertoarea)orasstrong\n\naspreferringcomponentsthatmatchaparticularshape\n\nmodel.Notethattheresultofthiswouldnotsolelybe\n\ncomponentsofthedesiredshape,howeverforanytwo\n\nneighboringcomponentsoneofthemwouldbeofthe\n\ndesiredshape.\n4.TheAlgorithmanditsProperties\nInthissectionwedescribeandanalyzeanalgorithmfor\nproducingasegmentationusingthedecisioncriterion\nDintroducedabove.Wewillshowthatasegmenta-\ntionproducedbythisalgorithmobeysthepropertiesof\n\nbeingneither\ntoocoarse\nnortoone\n,accordingtothe\nfollowingdenitions.\nDenition1.\nAsegmentationSistoone\nifthereis\nsomepairofregions\nC1,C2Sforwhichthereisno\nevidenceforaboundarybetweenthem.\nInordertodenethecomplementarynotionofwhat\nitmeansforasegmentationtobetoocoarse(tohave\n\ntoofewcomponents),werstintroducethenotionofa\n\nrenementofasegmentation.Giventwosegmentations\nSandTofthesamebaseset,wesaythat\nTisarene-\nmentof\nSwheneachcomponentof\nTiscontainedin\n(orequalto)somecomponentof\nS.Inaddition,wesay\nthatTisa\nproper\nrenementof\nSwhenT\n=S.Notethatif\nTisaproperrenementof\nS,thenTcanbe\nobtainedbysplittingoneormoreregionsof\nS.WhenTisaproperrenementof\nSwesaythat\nTisnerthan\nSandthat\nSiscoarserthan\nT.Denition2.\nAsegmentationSistoocoarse\nwhenthereexistsaproperrenementof\nSthatisnottoo\nne.Thiscapturestheintuitivenotionthatifregionsofaseg-\nmentationcanbesplitandyieldasegmentationwhere\n\nthereisevidenceforaboundarybetweenallpairsof\n\nneighboringregions,thentheinitialsegmentationhas\n\ntoofewregions.\nTwonaturalquestionsariseaboutsegmentationsthat\nareneithertoocoarsenortoone,namelywhetheror\n\nnotonealwaysexists,andifsowhetherornotitis\n\nunique.Firstwenotethatingeneraltherecanbemore\n\nthanonesegmentationthatisneithertoocoarsenor\ntoone,sosuchasegmentationisnotunique.Onthe\nquestionofexistence,thereisalwayssomesegmenta-\n\ntionthatisbothnottoocoarseandnottoone,aswe\n\nnowestablish.\nProperty1.\nFor\nany(nite)graphG\n=(V,E)there\nexistssomesegmentationSthatisneithertoocoarse\nnortoone.\nItiseasytoseewhythispropertyholds.Consider\nthesegmentationwherealltheelementsareinasingle\n\ncomponent.Clearlythissegmentationisnottoone,\n\nbecausethereisonlyonecomponent.Ifthesegmenta-\n\ntionisalsonottoocoarsewearedone.Otherwise,by\n\nthedenitionofwhatitmeanstobetoocoarsethere\n\nisaproperrenementthatisnottoone.Pickoneof\n\nthoserenementsandkeeprepeatingthisprocedure\n\nuntilweobtainasegmentationthatisnottoocoarse.\n\nTheprocedurecanonlygoonfor\nn1stepsbecause\nwheneverwepickaproperrenementweincreasethe\n\nnumberofcomponentsinthesegmentationbyatleast\n\none,andthenestsegmentationwecangetistheone\n\nwhereeveryelementisinitsowncomponent.\nWenowturntothesegmentationalgorithm,whichis\ncloselyrelatedtoKruskalsalgorithmforconstructing\n\naminimumspanningtreeofagraph(cf.Cormenetal.,\n1990).Itcanbeimplementedtorunin\nO(mlogm)time,where\nmisthenumberofedgesinthegraph.\nAlgorithm1.\nSegmentationalgorithm.\nTheinputisagraph\nG=(V,E),with\nnverticesandmedges.Theoutputisasegmentationof\nVintocomponentsS=(C1,...,Cr).0.Sort\nEinto=(o1,...,om),bynon-decreasing\nedgeweight.\n1.Startwithasegmentation\nS0,whereeachvertex\nviisinitsowncomponent.\n2.Repeatstep3for\nq=1,...,m.3.Construct\nSqgiven\nSq1asfollows.Let\nviandvjdenotetheverticesconnectedbythe\nq-thedge\nintheordering,i.e.,\noq=(vi,vj).If\nviandvjareindisjointcomponentsof\nSq1andw(oq)is\nsmallcomparedtotheinternaldifferenceofboth\n\nthosecomponents,thenmergethetwocomponents\n\notherwisedonothing.Moreformally,let\nCq1ibethecomponentof\nSq1containingviandCq1jthecomponentcontaining\nvj.If\nCq1i=Cq1jandw(oq)MInt(Cq1i,Cq1j)thenSqisobtained\n'b'EfcientGraph-BasedImageSegmentation173\nfromSq1bymerging\nCq1iandCq1j.OtherwiseSq=Sq1.4.Return\nS=Sm.Wenowestablishthatasegmentation\nSproducedbyAlgorithm1obeystheglobalpropertiesofbeing\n\nneithertoonenortoocoarsewhenusingthere-\n\ngioncomparisonpredicate\nDdenedin(3).Thatis,\nalthoughthealgorithmmakesonlygreedydecisions\n\nitproducesasegmentationthatsatisestheseglobal\n\nproperties.Moreover,weshowthatanyofthepossi-\n\nblenon-decreasingweightedgeorderingsthatcould\n\nbepickedinStep0ofthealgorithmproducethesame\n\nsegmentation.\nLemma1.\nInStep\n3ofthealgorithm\n,whenconsider-\ningedgeo\nq,iftwodistinctcomponentsareconsidered\nandnotmergedthenoneofthesetwocomponentswill\n\nbeinthenalsegmentation.LetC\nq1iandC\nq1jdenotethetwocomponentsconnectedbyedgeo\nq=(vi,vj)whenthisedgeisconsideredbythealgorithm.Thenei-\n\ntherC\ni=Cq1iorC\nj=Cq1j,whereC\niisthecompo-\nnentcontaining\nviandC\njisthecomponentcontaining\nvjinthenalsegmentationS.\nProof:\nTherearetwocasesthatwouldresult\ninamergenothappening.Saythatitisdueto\n\nw(oq)>Int(Cq1i)+(Cq1i).Sinceedgesareconsid-\neredinnon-decreasingweightorder,\nw(ok)w(oq),forall\nkq+1.Thusnoadditionalmergeswill\nhappentothiscomponent,i.e.,\nCi=Cq1i.Thecase\nforw(oq)>Int(Cq1j)+(Cq1j)isanalogous.NotethatLemma1impliesthattheedgecausing\nthemergeoftwocomponentsisexactlytheminimum\n\nweightedgebetweenthecomponents.Thustheedges\n\ncausingmergesareexactlytheedgesthatwouldbe\n\nselectedbyKruskalsalgorithmforconstructingthe\n\nminimumspanningtree(MST)ofeachcomponent.\nTheorem1\n.ThesegmentationSproducedby\nAlgorithm1isnottooneaccordingtoDenition\n1,usingtheregioncomparisonpredicateDdenedin\n(3).Proof:\nBydenition,inorderfor\nStobetoone\nthereissomepairofcomponentsforwhich\nDdoesnot\nhold.Theremustbeatleastoneedgebetweensuch\n\napairofcomponentsthatwasconsideredinStep3\nanddidnotcauseamerge.Let\noq=(vi,vj)bethe\nrstsuchedgeintheordering.Inthiscasethealgo-\n\nrithmdecidednottomerge\nCq1iwithCq1jwhichimpliesw(oq)>MInt(Cq1i,Cq1j).ByLemma1we\nknowthateither\nCi=Cq1iorCj=Cq1j.Eitherway\nweseethat\nw(oq)>MInt(Ci,Cj)implyingDholdsforCiandCj,whichisacontradiction.\nTheorem2\n.ThesegmentationSproducedby\nAlgorithm1isnottoocoarseaccordingtoDenition\n2,usingtheregioncomparisonpredicateDdenedin\n\n(3).Proof:\nInorderfor\nStobetoocoarsetheremustbe\nsomeproperrenement,\nT,thatisnottoone.Con-\nsidertheminimumweightedge\nethatisinternaltoa\ncomponentCSbutconnectsdistinctcomponents\nA,BT.Notethatbythedenitionofrenement\nACandBC.SinceTisnottoone,either\nw(e)>Int(A)+(A)orw(e)>Int(B)+(B).Withoutlossofgenerality,say\ntheformeristrue.Byconstructionanyedgeconnecting\nAtoanothersub-componentof\nChasweightatleastas\nlargeas\nw(e),whichisinturnlargerthanthemaximum\nweightedgein\nMST(A,E)becausew(e)>Int(A).Thusthealgorithm,whichconsidersedgesinnon-\n\ndecreasingweightorder,mustconsideralltheedges\n\ninMST(A,E)beforeconsideringanyedgefrom\nAtootherpartsof\nC.Sothealgorithmmusthaveformed\nAbeforeforming\nC,andinforming\nCitmusthave\nmerged\nAwithsomeothersub-componentof\nC.Theweightoftheedgethatcausedthismergemustbeleast\n\naslargeas\nw(e).However,thealgorithmwouldnothave\nmerged\nAinthiscasebecause\nw(e)>Int(A)+(A),whichisacontradictionbecausethealgorithmdid\n\nformC.Theorem3\n.Thesegmentationproducedby\nAlgorithm1doesnotdependonwhichnon-decreasing\nweightorderoftheedgesisused.\nProof:\nAnyorderingcanbechangedintoanother\nonebyonlyswappingadjacentelements.Thusitis\n\nsufcienttoshowthatswappingtheorderoftwoad-\n\njacentedgesofthesameweightinthenon-decreasing\n\nweightorderingdoesnotchangetheresultproducedby\n\nAlgorithm1.\nLete1ande2betwoedgesofthesameweightthat\nareadjacentinsomenon-decreasingweightordering.\n\nClearlyifwhenthealgorithmconsiderstherstofthese\n\ntwoedgestheyconnectdisjointpairsofcomponents\n\norexactlythesamepairofcomponents,thentheor-\n\nderinwhichthetwoareconsidereddoesnotmatter.\n\nTheonlycaseweneedtocheckiswhen\ne1isbetween\n'b'174FelzenszwalbandHuttenlocher\ntwocomponents\nAandBande2isbetweenoneof\nthesecomponents,say\nB,andsomeothercomponent\nC.Nowweshowthat\ne1causesamergewhencon-\nsideredafter\ne2exactlywhenitwouldcauseamerge\nifconsideredbefore\ne2.First,supposethat\ne1causesamergewhenconsideredbefore\ne2.Thisimplies\nw(e1)MInt(A,B).If\ne2wereinsteadconsidered\nbeforee1,eithere2wouldnotcauseamergeandtriv-\niallye1wouldstillcauseamerge,or\ne2wouldcause\namergeinwhichcasethenewcomponent\nBCwouldhave\nInt(BC)=w(e2)=w(e1).Sowe\nknow\nw(e1)MInt(A,BC)whichimplies\ne1willstillcauseamerge.Ontheotherhand,supposethat\n\ne1doesnotcauseamergewhenconsideredbefore\ne2.Thisimplies\nw(e1)>MInt(A,B).Theneither\nw(e1)>Int(A)+(A),inwhichcasethiswould\nstillbetrueif\ne2wereconsideredrst(because\ne2doesnottouch\nA),or\nw(e1)>Int(B)+(B).Inthis\nsecondcase,if\ne2wereconsideredrstitcouldnot\ncauseamergesince\nw(e2)=w(e1)andso\nw(e2)>MInt(B,C).Thuswhenconsidering\ne1aftere2westill\nhave\nw(e1)>MInt(A,B)ande1doesnotcausea\nmerge.\n4.1.ImplementationIssuesandRunningTime\nOurimplementationmaintainsthesegmentation\nSus-ingadisjoint-setforestwithunionbyrankandpath\n\ncompression(cf.Cormenetal.,1990).Therunning\n\ntimeofthealgorithmcanbefactoredintotwoparts.\n\nFirstinStep0,itisnecessarytosorttheweightsinto\n\nnon-decreasingorder.Forintegerweightsthiscanbe\n\ndoneinlineartimeusingcountingsort,andingeneral\n\nitcanbedonein\nO(mlogm)timeusinganyoneof\nseveralsortingmethods.\nSteps13ofthealgorithmtake\nO(m(m))time,\nwhereistheveryslow-growinginverseAckermans\nfunction.Inordertocheckwhethertwoverticesarein\n\nthesamecomponentweuseset-ndoneachvertex,and\n\ninordertomergetwocomponentsweuseuseset-union.\n\nThusthereareatmostthreedisjoint-setoperationsper\n\nedge.Thecomputationof\nMIntcanbedoneinconstant\ntimeperedgeifweknow\nIntandthesizeofeachcom-\nponent.Maintaining\nIntforacomponentcanbedonein\nconstanttimeforeachmerge,asthemaximumweight\n\nedgeintheMSTofacomponentissimplytheedge\n\ncausingthemerge.ThisisbecauseLemma1implies\n\nthattheedgecausingthemergeistheminimumweight\n\nedgebetweenthetwocomponentsbeingmerged.The\nsizeofacomponentafteramergeissimplythesumof\nthesizesofthetwocomponentsbeingmerged.\n5.ResultsforGridGraphs\nFirstweconsiderthecaseofmonochrome(intensity)\nimages.Colorimagesarehandledasthreeseparate\n\nmonochromeimages,asdiscussedbelow.Asinother\n\ngraph-basedapproachestoimagesegmentation(e.g.,\n\nShiandMalik,1997;WuandLeahy,1993;Zahn,1971)\n\nwedeneanundirectedgraph\nG=(V,E),whereeach\nimagepixel\npihasacorrespondingvertex\nviV.Theedgeset\nEisconstructedbyconnectingpairsofpixels\nthatareneighborsinan8-connectedsense(anyother\n\nlocalneighborhoodcouldbeused).Thisyieldsagraph\n\nwherem=O(n),sotherunningtimeofthesegmenta-\ntionalgorithmis\nO(nlogn)fornimagepixels.Weuse\nanedgeweightfunctionbasedontheabsoluteintensity\n\ndifferencebetweenthepixelsconnectedbyanedge,\nw(vi,vj)=|I(pi)I(pj)|whereI(pi)istheintensityofthepixel\npi.Ingeneralwe\nuseaGaussianltertosmooththeimageslightlybefore\n\ncomputingtheedgeweights,inordertocompensatefor\n\ndigitizationartifacts.WealwaysuseaGaussianwith\n\n=0.8,whichdoesnotproduceanyvisiblechange\ntotheimagebuthelpsremoveartifacts.\nForcolorimageswerunthealgorithmthreetimes,\nonceforeachofthered,greenandbluecolorplanes,\n\nandthenintersectthesethreesetsofcomponents.\n\nSpecically,weputtwoneighboringpixelsinthesame\n\ncomponentwhentheyappearinthesamecomponentin\n\nallthreeofthecolorplanesegmentations.Alternatively\n\nonecouldrunthealgorithmjustonceonagraphwhere\n\ntheedgeweightsmeasurethedistancebetweenpixels\n\ninsomecolorspace,howeverexperimentallyweob-\n\ntainedbetterresultsbyintersectingthesegmentations\n\nforeachcolorplaneinthemannerjustdescribed.\nThereisoneruntimeparameterforthealgorithm,\nwhichisthevalueof\nkthatisusedtocompute\nthethresholdfunction\n.Recallweusethefunction\n(C)=k/|C|where|C|isthenumberofelements\ninC.Thuskeffectivelysetsascaleofobservation,in\nthatalarger\nkcausesapreferenceforlargercompo-\nnents.Weusetwodifferentparametersettingsforthe\n\nexamplesinthissection(andthroughoutthepaper),\ndependingontheresolutionoftheimageandthede-\n\ngreetowhichnedetailisimportantinthescene.For\n\ninstance,inthe128\n128imagesoftheCOILdatabase\n'b'EfcientGraph-BasedImageSegmentation175\nofobjectsweuse\nk=150.Inthe320\n240orlarger\nimages,suchasthestreetsceneandthebaseballplayer,\n\nweuse\nk=300.TherstimageinFig.2showsastreetscene.Note\nthatthereisconsiderablevariationinthegrassyslope\n\nleadinguptothefence.Itisthiskindofvariabilitythat\n\nouralgorithmisdesignedtohandle(recallthehigh\n\nvariabilityregioninthesyntheticexampleinFig.1).\nThesecondimageshowsthesegmentation,whereeach\n\nregionisassignedarandomcolor.Thesixlargestcom-\n\nponentsfoundbythealgorithmare:threeofthegrassy\n\nareasbehindthefence,thegrassyslope,thevan,and\n\ntheroadway.Themissingpartoftheroadwayatthe\n\nlowerleftisavisiblydistinctregioninthecolorimage\n\nfromwhichthissegmentationwascomputed(aspot\n\nduetoanimagingartifact).Notethatthevanisalso\n\nnotuniformincolor,duetospecularreections,but\n\nthesearediffuseenoughthattheyaretreatedasinter-\n\nnalvariationandincorporatedintoasingleregion.\nTherstimageinFig.3showstwobaseballplayers\n(fromShiandMalik,1997).Asinthepreviousexam-\n\nple,thereisagrassyregionwithconsiderablevariation.\n\nTheuniformsoftheplayersalsohavesubstantialvari-\n\nationduetofoldsinthecloth.Thesecondimageshows\n\nthesegmentation.Thesixlargestcomponentsfoundby\n\nthealgorithmare:thebackwall,theMetsemblem,a\n\nlargegrassyregion(includingpartofthewallunder\n\nthetopplayer),eachofthetwoplayersuniforms,and\n\nasmallgrassypatchunderthesecondplayer.Thelarge\ngrassyregionincludespartofthewallduetotherela-\n\ntivelyhighvariationintheregion,andthefactthatthere\n\nisalongslowchangeinintensity(notstrongevidence\n\nforaboundary)betweenthegrassandthewall.This\n\nboundaryissimilarinmagnitudetothosewithinthe\n\nplayeruniformsduetofoldsinthecloth.\nFigure4showstheresultsofthealgorithmforan\nimageofanindoorscene,wherebothnedetailand\n\nlargerstructuresareperceptuallyimportant.Notethat\n\nthesegmentationpreservessmallregionssuchasthe\n\nnametagsthepeoplearewearingandthingsbehind\n\nthewindows,whilecreatingsinglelargerregionsfor\n\nhighvariabilityareassuchastheairconditioningduct\n\nnearthetopoftheimage,theclothingandthefur-\n\nniture.Thisimagealsoshowsthatsometimessmall\n\nboundaryregionsarefound,forexampleattheedge\n\nofthejacketorshirt.Suchnarrowregionsoccurbe-\n\ncausethereisaoneortwopixelwideareathatis\n\nhalfwaybetweenthetwoneighboringregionsincolor\n\nandintensity.Thisiscommoninanysegmentation\n\nmethodbasedongridgraphs.Suchregionscanbeelim-\ninatedifdesired,byremovinglongthinregionswhose\ncolororintensityisclosetotheaverageofneighboring\n\nregions.\nFigure5showsthreesimpleobjectsfromthe\nColumbiaCOILimagedatabase.Shownforeachisthe\n\nlargestregionfoundbyouralgorithmthatisnotpart\n\noftheblackbackground.Notethateachoftheseob-\n\njectshasasubstantialintensitygradientacrosstheface\n\noftheobject,yettheregionsarecorrectlysegmented.\n\nThisillustratesanothersituationthatthealgorithmwas\n\ndesignedtohandle,slowchangesinintensitydueto\n\nlighting.6.ResultsforNearestNeighborGraphs\nOnecommonapproachtoimagesegmentationisbased\nonmappingeachpixeltoapointinsomefeature\n\nspace,andthenndingclustersofsimilarpoints(e.g.,\n\nComaniciuandMeer,1997,1999;JainandDubes,\n\n1988).Inthissectionweinvestigateusingthegraph-\n\nbasedsegmentationalgorithmfromSection4inorder\n\ntondsuchclustersofsimilarpoints.Inthiscase,the\n\ngraphG=(V,E)hasavertexcorrespondingtoeach\nfeaturepoint(eachpixel)andthereisanedge(\nvi,vj)connectingpairsoffeaturepoints\nviandvjthatare\nnearbyinthefeaturespace,ratherthanusingneighbor-\n\ningpixelsintheimagegrid.Thereareseveralpossible\n\nwaysofdeterminingwhichfeaturepointstoconnect\nbyedges.Weconnecteachpointtoaxednumberof\n\nnearestneighbors.Anotherpossibilityistouseallthe\n\nneighborswithinsomexeddistance\nd.Inanyevent,itisdesirabletoavoidconsideringall\nO(n2)pairsof\nfeaturepoints.\nTheweight\nw(vi,vj)ofanedgeisthedistancebe-\ntweenthetwocorrespondingpointsinfeaturespace.\n\nFortheexperimentsshownherewemapeachpixel\ntothefeaturepoint(\nx,y,r,g,b),where(\nx,y)is\nthelocationofthepixelintheimageand(\nr,g,b)is\nthecolorvalueofthepixel.Weusethe\nL2(Euclidean)distancebetweenpointsastheedgeweights,although\n\notherdistancefunctionsarepossible.\nTheinternaldifferencemeasure,\nInt(C),hasarela-\ntivelysimpleunderlyingintuitionforpointsinfeature\n\nspace.Itspeciestheminimumradiusofdilation\n\nnecessarytoconnectthesetoffeaturepointscon-\n\ntainedin\nCtogetherintoasinglevolumeinfeature\nspace.Considerreplacingeachfeaturepointbyaball\n\nwithradius\nr.FromthedenitionoftheMSTitcan\nbeseenthattheunionoftheseballswillformone\n'b'176FelzenszwalbandHuttenlocher\nFigure2\n.Astreetscene(320\n240colorimage),andthesegmentationresultsproducedbyouralgorithm(\n=0.8,k=300).Figure3\n.Abaseballscene(432\n294greyimage),andthesegmentationresultsproducedbyouralgorithm(\n=0.8,k=300).Figure4\n.Anindoorscene(image320\n240,color),andthesegmentationresultsproducedbyouralgorithm(\n=0.8,k=300).singleconnectedvolumeonlywhen\nrInt(C)/2.Thedifferencebetweencomponents,\nDif(C1,C2),also\nhasasimpleunderlyingintuition.Itspeciesthemin-\n\nimumradiusofdilationnecessarytoconnectatleast\n\nonepointof\nC1toapointof\nC2.Oursegmentationtech-\nniqueisthuscloselyrelatedtotheworkofComaniciu\n\nandMeer(1999),whichsimilarlytakesanapproach\n\ntoclusteringbasedondilatingpointsinaparameter\nspace(howevertheyrstuseanoveltransformation\nofthedatathatwedonotperform,andthenusea\n\nxeddilationradiusratherthanthevariableonethatwe\n\nuse).Ratherthanconstructingthecompletegraph,where\nallpointsareneighborsofoneanother,wenda\n\nsmallxednumberofneighborsforeachpoint.This\n\nresultsinagraphwith\nO(n)edgesfor\nnimage'b'EfcientGraph-BasedImageSegmentation177\nFigure5\n.ThreeimagesfromtheCOILdatabase,andthelargest\nnon-backgroundcomponentfoundineachimage(128\n128color\nimages;algorithmparameters\n=0.8,k=150).pixels,andanoverallrunningtimeofthesegmenta-\ntionmethodof\nO(nlogn)time.Therearemanypos-\nsiblewaysofpickingasmallxednumberofneigh-\n\nborsforeachpoint.WeusetheANNalgorithm(Arya\n\nandMount,1993)tondthenearestneighborsfor\n\neachpoint.Thisalgorithmisquitefastinpractice,\n\ngivena5-dimensionalfeaturespacewithseveralhun-\n\ndredthousandpoints.TheANNmethodalsoallows\n\nthendingofapproximatenearestneighbors,which\n\nrunsmorequicklythanndingtheactualnearestneigh-\n\nbors.Fortheexamplesreportedhereweusetennear-\n\nestneighborsofeachpixeltogeneratetheedgesofthe\n\ngraph.Oneofthekeydifferencesfromtheprevioussection,\nwheretheimagegridwasusedtodenethegraph,\n\nisthatthenearestneighborsinfeaturespacecapture\n\nmorespatiallynon-localpropertiesoftheimage.Inthe\n\ngrid-graphcase,alloftheneighborsinthegraphare\n\nneighborsintheimage.Here,pointscanbefarapart\n\nintheimageandstillbeamongahandfulofnearest\nFigure6\n.Asyntheticimage(40\n32greyimage)andthesegmentationusingthenearestneighborgraph(\n=0,k=150).neighbors(iftheircolorishighlysimilarandinterven-\ningimagepixelsareofdissimilarcolor).Forinstance,\n\nthiscanresultsegmentationswithregionsthataredis-\n\nconnectedintheimage,whichdidnothappeninthe\n\ngrid-graphcase.\nFigure6showsasyntheticimagefromPeronaand\nFreeman(1998)andGdalyahuetal.(1999)andits\n\nsegmentation,using\nk=150andwithnosmoothing\n(=0).Inthisexamplethespatiallydisconnectedre-\ngionsdonotreectinterestingscenestructures,butwe\n\nwillseeexamplesbelowwhichdo.\nFortheremainingexamplesinthissection,weuse\nk=300and\n=0.8,asintheprevioussection.\nFirst,wenotethatthenearestneighborgraphproduces\n\nsimilarresultstothegridgraphforimagesinwhich\n\ntheperceptuallysalientregionsarespatiallyconnected.\n\nForinstance,thestreetsceneandbaseballplayerscene\nconsideredintheprevioussectionyieldverysimilar\n\nsegmentationsusingeitherthenearestneighborgraph\n\northegridgraph,ascanbeseenbycomparingthe\n\nresultsinFig.7withthoseinFigs.2and3.\nFigure8showstwoadditionalexamplesusingthe\nnearestneighborgraph.Theseresultsarenotpossible\n\ntoachievewiththegridgraphapproachbecausecertain\n\ninterestingregionsarenotspatiallyconnected.Therst\n\nexampleshowsaowergarden,wheretheredowers\narespatiallydisjointintheforegroundoftheimage,and\n\nthenmergetogetherinthebackground.Mostofthese\n\nowersaremergedintoasingleregion,whichwould\n\nnotbepossiblewiththegrid-graphmethod.Thesec-\n\nondexampleinFig.8showstheEiffeltoweratnight.\n\nThebrightyellowlightformsaspatiallydisconnected\n\nregion.Theseexamplesshowthatthesegmentation\n\nmethod,coupledwiththeuseofanearestneighbor\n\ngraph,cancaptureveryhighlevelpropertiesofim-\n\nages,whilepreservingperceptuallyimportantregion\n\nboundaries.'b'178FelzenszwalbandHuttenlocher\nFigure7\n.Segmentationofthestreetandbaseballplayerscenesfromtheprevioussection,usingthenearestneighborgraphratherthanthe\ngridgraph(\n=0.8,k=300).Figure8\n.Segmentationusingthenearestneighborgraphcancapturespatiallynon-localregions(\n=0.8,k=300).7.SummaryandConclusions\nInthispaperwehaveintroducedanewmethodfor\nimagesegmentationbasedonpairwiseregioncompar-\n\nison.Wehaveshownthatthenotionsofasegmentation\n\nbeingtoocoarseortoonecanbedenedintermsofa\n\nfunctionwhichmeasurestheevidenceforaboundary\nbetweenpairsofregions.Oursegmentationalgorithm\nmakessimplegreedydecisions,andyetproducesseg-\n\nmentationsthatobeytheglobalpropertiesofbeingnot\n\ntoocoarseandnottooneusingaparticularregion\n\ncomparisonfunction.Themethodrunsin\nO(mlogm)timefor\nmgraphedgesandisalsofastinpractice,\ngenerallyrunninginafractionofasecond.\n'b'EfcientGraph-BasedImageSegmentation179\nThepairwiseregioncomparisonpredicateweuse\nconsiderstheminimumweightedgebetweentwore-\n\ngionsinmeasuringthedifferencebetweenthem.Thus\n\nouralgorithmwillmergetworegionsevenifthereis\n\nasinglelowweightedgebetweenthem.Thisisnot\nasmuchofaproblemasitmightrstappear,inpart\n\nbecausethisedgeweightiscomparedonlytothemin-\n\nimumspanningtreeedgesofeachcomponent.Forin-\n\nstance,theexamplesconsideredinSections5and6\n\nillustratethatthemethodndssegmentationsthatcap-\n\nturemanyperceptuallyimportantaspectsofcomplex\n\nimagery.Nonetheless,onecanenvisionmeasuresthat\n\nrequiremorethanasinglecheapconnectionbeforede-\n\ncidingthatthereisnoevidenceforaboundarybetween\n\ntworegions.Onenaturalwayofaddressingthisissueis\n\ntouseaquantileratherthantheminimumedgeweight.\n\nHowever,inthiscasendingasegmentationthatisnei-\n\nthertoocoarsenortooneisanNP-hardproblem(as\n\nshownintheAppendix).Ouralgorithmisunique,in\n\nthatitisbothhighlyefcientandyetcapturesnon-local\n\npropertiesofimages.\nWehaveillustratedourimagesegmentationalgo-\nrithmwithtwodifferentkindsofgraphs.Therstof\n\ntheseusestheimagegridtodenealocalneighborhood\n\nbetweenimagepixels,andmeasuresthedifferencein\n\nintensity(orcolor)betweeneachpairofneighbors.\n\nThesecondofthesemapstheimagepixelstopointsin\n\nafeaturespacethatcombinesthe(\nx,y)locationand\n(r,g,b)colorvalue.Edgesinthegraphconnectpoints\nthatareclosetogetherinthisfeaturespace.Thealgo-\n\nrithmyieldsgoodresultsusingbothkindsofgraphs,\n\nbutthelattertypeofgraphcapturesmoreperceptually\nglobalaspectsoftheimage.\nImagesegmentationremainsachallengingproblem,\nhoweverwearebeginningtomakesubstantialprogress\n\nthroughtheintroductionofgraph-basedalgorithms\n\nthatbothhelpreneourunderstandingoftheproblem\n\nandprovideusefulcomputationaltools.Theworkre-\n\nportedhereandthenormalizedcutsapproach(Shiand\n\nMalik,1997)arejustafewillustrationsoftheserecent\n\nadvances.\nAppendix:NP-Hardnessof\nDwithQuantiles\nIntuitivelytheregioncomparisonpredicate\nDde-nedinSection3.1couldbemademorerobustby\n\nchangingthedenitionofthedifferencebetweentwo\n\nregionstoreectaquantileratherthanthemini-\n\nmumweightedgebetweenthem.Weshowthatwith\n\nthismodicationtheproblemofndingasegmenta-\ntionthatisneithertoocoarsenortoonebecomes\nNP-hard.Theonlydifferencebetweenthenewproblemand\ntheoldoneisthedenitionofthedifferencebetween\n\ntworegions\nC1,C2SinEq.(2),whichbecomes\nDif(C1,C2)=Kthw(vi,vj)(6)whereKthselectsthe\nKthquantileofitsarguments\n(Kshouldbebetweenzeroandone).Forexample\nwithK=0.5thedifferencebecomesthemedianedge\nweightbetweenthetwocomponents.Thisquantileis\n\ncomputedoveralledges(\nvi,vj)suchthat\nviC1andvjC2.Wereducetheminratiocutproblemwithuniform\ncapacitiesanddemandstotheproblemofndinga\n\ngoodsegmentation.Theminratiocutproblemwith\n\nuniformcapacitiesanddemandsisthefollowing:we\n\naregivenagraph\nG=(V,E)andanothersetofedges\nF.Eachedgein\nEindicatesaunitcapacitybetween\napairofnodesandeachedgein\nFindicatesaunit\ndemandbetweenapairofnodes.Thevalueofacut\n\n(A,B)istheratioofthetotalcapacityandthetotal\ndemandbetweenthesets\nAandB.Soitistheratioof\nthenumberedgesin\nEcrossingthecutandthenumber\nofedgesin\nFcrossingthecut.Findingthevalueofthe\nminimumratiocutisanNP-hardproblem(cf.Ausiello\n\netal.,toappear).\nFirstweshowhowtotransformaninstanceofthis\nproblemtoonewherethesets\nEandFaredisjoint,\nwithoutmodifyingthevalueoftheminimumcut.For\n\neveryedge(\na,b)EFwecreateanewnode\nab,andexchangetheedgein\nEwiththeedges(\na,ab)and(b,ab).Foracutwith\naandbinthesameside,its\nalwaysbettertokeep\nabinthatsidetooandthevalue\nofthecutisthesameasintheoriginalgraph.Fora\n\ncutwith\naandbindifferentsidesthenode\nabcanbe\nineithersideandtherewillbeonecapacityandone\n\ndemandedgecrossingthecutandthevalueofcutis\n\nagainthesameasintheoriginalgraph.\nNowweshowhowtodecideifthemodiedinstance\noftheminratiocutproblemhasacutwithvalueat\n\nmostvbysolvingasegmentationproblem.Let\ncbethenumberofedgesfrom\nEcrossingacut(\nA,B)andsimilarlydisthenumberofedgesfrom\nFcrossing(A,B).Itseasytoshowthatthecutvalueissmall\nexactlywhenthefractionofedgescrossingthecutthat\ncomefrom\nFislarge,\ncdvdc+d1v+1(7)'b'180FelzenszwalbandHuttenlocher\nDeneG=(V,E)whereE=EF.We\nletthe\nedgesfrom\nEhaveweightzeroandtheedgesfrom\nFhaveweightone.\nLemma2.\nThegraphGhasacutwithvalueatmost\nvifandonlyifasegmentationofG\nisnotonesingle\ncomponent,whereDifisdenedinEq.\n(6),K=11/(v+1)and(C)=0forallC.\nProof:\nFirstweshowthatif\nGhasacut(\nA,B)withvalueatmost\nvthereexists\nCAsuchthattheseg-\nmentation{C,C}isnottoone.Wejustneedtond\nCsuchthat\nInt(C)=0andDif(C,C)=1.If\nGhasacut\n(A,B)withvalueatmost\nv,thanEq.(7)tellsusthat\nd/(c+d)1/(v+1).Rememberthatthereare\ndedgesofweightoneand\ncedgesofweightzerocrossingthe\ncut.Sothefractionofweightoneedgescrossingthe\n\ncutisatleast1\n/(v+1).Lookattheconnectedcom-\nponentsof\nAusingonlyedgesofweightzero.Clearly\nInt(C)=0forallsuchcomponents.Let\nCbethecom-\nponentwithlargestfractionofweightoneedgesgoing\n\ntoB.Thisfractionmustbeatleast1\n/(v+1).More-\nover,thefractionofweightoneedgesbetween\nCandC=VCisatleastaslargesince\nC=B(CA)andthethereareonlyweightoneedgesbetween\nCandCA.Thisimpliesthefractionofweightzeroedges\nbetweenCandCislessthan1\n1/(v+1)=K.So\ntheKthquantileweightbetween\nCandCisone.Thus\nDif(C,C)=1andthesegmentation\nS={C,C}ofGisnottoone.Hencethesegmentationof\nGasa\nsinglecomponentistoocoarse.\nIfGhasasegmentationthatisnotasingle\ncomponentS={C1,...,Cl}thenthe\nKthquantile\nedgeweightbetweeneverypairofcomponents\nCiandCjisone(orelsethesegmentationwouldbetoone).\nThusthe\nKthquantileedgeweightbetween\nC1andC1=C2\nClisone.Sothefractionofweight\noneedgesbetween\nC1andC1isatleast1\n/(v+1).Equation(7)impliesthatvalueofthecut(\nC1,C1)is\natmost\nv.Itisstraightforwardtoseethatthetransformationof\ntheminratiocutproblemtotheproblemofndinga\n\nsegmentationpresentedabovecanbedoneinpolyno-\n\nmialtime.Thisissufcienttoshowthehardnessofthe\n\nsegmentationproblem.\nTheorem4\n.Theproblemofndingasegmentation\nthatisneithertoocoarsenortooneusingDifas\n\ndenedinEq.\n(6)isNP-hard.\nAcknowledgments\nThisworkwassupportedinpartbygiftsfromIntel,\nMicrosoftandXeroxcorporations,inpartbyDARPA\n\nundercontractDAAL01-97-K-0104,andinpartby\n\nNSFResearchInfrastructureawardCDA-9703470.\n\nWewouldliketothankShreeNayar,JianboShiand\nDaphnaWeinshallforuseoftheirimages.Wewould\n\nalsoliketothankJonKleinberg,EvaTardosandDan\n\nRamrasfordiscussionsaboutthealgorithmandtheNP\n\nhardnessresult.\nReferences\nArya,S.andMount,D.M.1993.Approximatenearestneighbor\nsearching.In\nProc.4thAnnualACM-SIAMSymposiumonDis-\ncreteAlgorithms\n,pp.271280.\nAusiello,G.,Crescenzi,P.,Gambosi,G.,Kann,V.,Marchetti\nSpaccamela,A.,andProtasi,M.(toappear).\nComplexityandAp-\nproximation.CombinatorialOptimizationProblemsandtheirAp-\n\nproximabilityProperties\n.Springer-Verlag:Berlin.\nComaniciu,D.andMeer,P.1997.Robustanalysisoffeature\nspaces:Colorimagesegmentation.In\nProceedingsofIEEECon-\nferenceonComputerVisionandPatternRecognition\n,pp.750\n755.Comaniciu,D.andMeer,P.1999.Meanshiftanalysisandappli-\ncations.In\nProceedingsofIEEEConferenceonComputerVision\nandPatternRecognition\n,pp.11971203.\nCooper,M.C.1998.Thetractabilityofsegmentationandsceneanal-\nysis.InternationalJournalofComputerVision\n,30(1):2742.Cormen,T.H.,Leiserson,C.E.,andRivest,R.L.1990.\nIntroduction\ntoAlgorithms\n.TheMITPress:McGraw-HillBookCompany.\nFelzenszwalb,P.andHuttenlocher,D.1998.Imagesegmentationus-\ninglocalvariation.In\nProceedingsofIEEEConferenceonCom-\nputerVisionandPatternRecognition\n,pp.98104.\nGdalyahu,Y.,Weinshall,D.,andWerman,M.1999.Stochasticclus-\nteringbytypicalcuts.In\nProceedingsofIEEEConferenceonCom-\nputerVisionandPatternRecognition\n,pp.25962601.\nJain,A.K.andDubes,R.C.1988.\nAlgorithmsforClusteringData\n.PrenticeHall.\nJermyn,I.andIshikawa,H.2001.Globallyoptimalregionsand\nboundariesasminimumratioweightcycles.\nIEEETransac-\ntionsonPatternAnalysisandMachineIntelligence\n,23:10751088.Pavlidas,T.1977.\nStructuralPatternRecognition\n.Springer-Verlag.\nPerona,P.andFreeman,W.1998.Afactorizationapproachtogroup-\ning.In\nProceedingsoftheEuropeanConferenceonComputer\nVision,pp.655670.\nRatan,A.L.,Maron,O.,Grimson,W.E.L.,andLozano-Perez,T.\n1999.Aframeworkforlearningqueryconceptsinimageclas-\n\nsication.In\nProceedingsoftheIEEEConferenceonComputer\nVisionandPatternRecognition\n,pp.423431.\nShi,J.andMalik,J.1997.Normalizedcutsandimagesegmentation.\nInProceedingsoftheIEEEConferenceonComputerVisionand\nPatternRecognition\n,pp.731737.\nUrquhart,R.1982.Graphtheoreticalclusteringbasedonlimited\nneighborhoodsets.\nPatternRecognition\n,15(3):173187.'b'EfcientGraph-BasedImageSegmentation181\nWeiss,Y.1999.Segmentationusingeigenvectors:Aunifyingview.In\nProceedingsoftheInternationalConferenceonComputerVision\n,2:975982.Wertheimer,M.1938.Lawsoforganizationinperceptualforms(par-\ntialtranslation).In\nASourcebookofGestaltPsychology\n.W.B.Ellis\n(Ed.).Harcourt,BraceandCompany,pp.7188.\nWu,Z.andLeahy,R.1993.Anoptimalgraphtheoreticapproachto\ndataclustering:Theoryanditsapplicationtoimagesegmentation.\n\nIEEETransactionsonPatternAnalysisandMachineIntelligence\n,11:11011113.Zahn,C.T.1971.Graph-theoreticmethodsfordetectinganddescrib-\ninggestaltclusters.\nIEEETransactionsonComputing\n,20:6886.'
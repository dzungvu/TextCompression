b'MITSUBISHIELECTRICRESEARCHLABORATORIES\nhttp://www.merl.com\nRapidObjectDetectionUsingaBoosted\nCascadeofSimpleFeatures\nViola,P.;Jones,M.\nTR2004-043May2004\nAbstract\nThispaperdescribesamachinelearningapproachforvisualobjectdetectionwhichiscapable\nofprocessingimagesextremelyrapidlyandachievinghighdetectionrates.Thisworkisdistin-\nguishedbythreekeycontributions.Theistheintroductionofanewimagerepresentation\ncalledtheIntegralImagewhichallowsthefeaturesusedbyourdetectortobecomputedvery\nquickly.Thesecondisalearningalgorithm,basedonAdaBoost,whichselectsasmallnum-\nberofcriticalvisualfeaturesfromalargersetandyieldsextremelyefThe\nthirdcontributionisamethodforcombiningincreasinglymorecomplexinacascade\nwhichallowsbackgroundregionsoftheimagetobequicklydiscardedwhilespendingmore\ncomputationonpromisingobject-likeregions.Thecascadecanbeviewedasanobject\nfocus-of-attentionmechanismwhichunlikepreviousapproachesprovidesstatisticalguarantees\nthatdiscardedregionsareunlikelytocontaintheobjectofinterest.Inthedomainoffacedetec-\ntionthesystemyieldsdetectionratescomparabletothebestprevioussystems.Usedinreal-time\napplications,thedetectorrunsat15framespersecondwithoutresortingtoimagedifferencing\norskincolordetection.\nIEEEComputerSocietyConferenceonComputerVisionandPatternRecognition\nThisworkmaynotbecopiedorreproducedinwholeorinpartforanycommercialpurpose.Permissiontocopyinwholeorinpart\nwithoutpaymentoffeeisgrantedforeducationalandresearchpurposesprovidedthatallsuchwholeorpartialcopiesinclude\nthefollowing:anoticethatsuchcopyingisbypermissionofMitsubishiElectricResearchLaboratories,Inc.;anacknowledgmentof\ntheauthorsandindividualcontributionstothework;andallapplicableportionsofthecopyrightnotice.Copying,reproduction,or\nrepublishingforanyotherpurposeshallrequirealicensewithpaymentoffeetoMitsubishiElectricResearchLaboratories,Inc.All\nrightsreserved.\nCopyright\nc\n\nMitsubishiElectricResearchLaboratories,Inc.,2004\n201Broadway,Cambridge,Massachusetts02139\n'b'MERLCoverPageSide2\n'b'MERLAMITSUBISHIELECTRICRESEARCHLABORATORY\nhttp://www.merl.com\nRapidObjectDetectionUsingaBoosted\nCascadeofSimpleFeatures\nPaulViolaandMichaelJones\nTR-2004-043May2004\nAbstract\nThispaperdescribesamachinelearningapproachforvisualobjectdetectionwhichiscapable\nofprocessingimagesextremelyrapidlyandachievinghighdetectionrates.Thisworkisdistin-\nguishedbythreekeycontributions.Theistheintroductionofanewimagerepresentation\ncalledtheIntegralImagewhichallowsthefeaturesusedbyourdetectortobecomputedvery\nquickly.Thesecondisalearningalgorithm,basedonAdaBoost,whichselectsasmallnum-\nberofcriticalvisualfeaturesfromalargersetandyieldsextremelyefThe\nthirdcontributionisamethodforcombiningincreasinglymorecomplexinacascade\nwhichallowsbackgroundregionsoftheimagetobequicklydiscardedwhilespendingmore\ncomputationonpromisingobject-likeregions.Thecascadecanbeviewedasanobject\nfocus-of-attentionmechanismwhichunlikepreviousapproachesprovidesstatisticalguarantees\nthatdiscardedregionsareunlikelytocontaintheobjectofinterest.Inthedomainoffacedetec-\ntionthesystemyieldsdetectionratescomparabletothebestprevioussystems.Usedinreal-time\napplications,thedetectorrunsat15framespersecondwithoutresortingtoimagedifferencing\norskincolordetection.\nThisworkmaynotbecopiedorreproducedinwholeorinpartforanycommercialpurpose.Permissiontocopyinwholeorinpart\nwithoutpaymentoffeeisgrantedforeducationalandresearchpurposesprovidedthatallsuchwholeorpartialcopiesinclude\nthefollowing:anoticethatsuchcopyingisbypermissionofMitsubishiElectricResearchLaboratories,Inc.;anacknowledgmentof\ntheauthorsandindividualcontributionstothework;andallapplicableportionsofthecopyrightnotice.Copying,reproduction,or\nrepublishingforanyotherpurposeshallrequirealicensewithpaymentoffeetoMitsubishiElectricResearchLaboratories,Inc.All\nrightsreserved.\nCopyright\nc\n\nMitsubishiElectricResearchLaboratories,Inc.,2004\n201Broadway,Cambridge,Massachusetts02139\n'b'PublicationHistory:\n1.Firstprinting,TR-2004-043,May2004\n'b'ACCEPTEDCONFERENCEONCOMPUTERVISIONANDPATTERNRECOGNITION2001RapidObjectDetectionusingaBoostedCascadeofSimpleFeaturesPaulViolaMichaelJonesviola@merl.commjones@crl.dec.comMitsubishiElectricResearchLabsCompaqCRL201Broadway,8thFLOneCambridgeCenterCambridge,MA02139Cambridge,MA02142AbstractThispaperdescribesamachinelearningapproachforvi-sualobjectdetectionwhichiscapableofprocessingimagesextremelyrapidlyandachievinghighdetectionrates.Thisworkisdistinguishedbythreekeycontributions.ThestistheintroductionofanewimagerepresentationcalledtheIntegralImagewhichallowsthefeaturesusedbyourde-tectortobecomputedveryquickly.Thesecondisalearningalgorithm,basedonAdaBoost,whichselectsasmallnum-berofcriticalvisualfeaturesfromalargersetandyieldsextremelyefts[6].Thethirdcontributionisamethodforcombiningincreasinglymorecomplexclassi-sinacascadewhichallowsbackgroundregionsoftheimagetobequicklydiscardedwhilespendingmorecompu-tationonpromisingobject-likeregions.Thecascadecanbeviewedasanobjectfocus-of-attentionmechanismwhichunlikepreviousapproachesprovidesstatisticalguar-anteesthatdiscardedregionsareunlikelytocontaintheob-jectofinterest.Inthedomainoffacedetectionthesystemyieldsdetectionratescomparabletothebestprevioussys-tems.Usedinreal-timeapplications,thedetectorrunsat15framespersecondwithoutresortingtoimagedifferenc-ingorskincolordetection.1.IntroductionThispaperbringstogethernewalgorithmsandinsightstoconstructaframeworkforrobustandextremelyrapidobjectdetection.Thisframeworkisdemonstratedon,andinpartmotivatedby,thetaskoffacedetection.Towardthisendwehaveconstructedafrontalfacedetectionsystemwhichachievesdetectionandfalsepositiverateswhichareequiv-alenttothebestpublishedresults[16,12,15,11,1].Thisfacedetectionsystemismostclearlydistinguishedfrompreviousapproachesinitsabilitytodetectfacesextremelyrapidly.Operatingon384by288pixelimages,facesarede-tectedat15framespersecondonaconventional700MHzIntelPentiumIII.Inotherfacedetectionsystems,auxiliaryinformation,suchasimagedifferencesinvideosequences,orpixelcolorincolorimages,havebeenusedtoachievehighframerates.Oursystemachieveshighframeratesworkingonlywiththeinformationpresentinasinglegreyscaleimage.Thesealternativesourcesofinformationcanalsobeintegratedwithoursystemtoachieveevenhigherframerates.Therearethreemaincontributionsofourobjectdetec-tionframework.Wewillintroduceeachoftheseideasbelowandthendescribethemindetailinsubsequentsections.Thecontributionofthispaperisanewimagerepre-sentationcalledanintegralimagethatallowsforveryfastfeatureevaluation.MotivatedinpartbytheworkofPapa-georgiouetal.ourdetectionsystemdoesnotworkdirectlywithimageintensities[10].LiketheseauthorsweuseasetoffeatureswhicharereminiscentofHaarBasisfunc-tions(thoughwewillalsouserelatedwhicharemorecomplexthanHaarInordertocomputethesefea-turesveryrapidlyatmanyscalesweintroducetheintegralimagerepresentationforimages.Theintegralimagecanbecomputedfromanimageusingafewoperationsperpixel.Oncecomputed,anyoneoftheseHarr-likefeaturescanbecomputedatanyscaleorlocationinconstanttime.Thesecondcontributionofthispaperisamethodforconstructingabyselectingasmallnumberofim-portantfeaturesusingAdaBoost[6].Withinanyimagesub-windowthetotalnumberofHarr-likefeaturesisverylarge,farlargerthanthenumberofpixels.Inordertoensurefastthelearningprocessmustexcludealargema-jorityoftheavailablefeatures,andfocusonasmallsetofcriticalfeatures.MotivatedbytheworkofTieuandViola,featureselectionisachievedthroughasimplemodoftheAdaBoostprocedure:theweaklearnerisconstrainedsothateachweakreturnedcandependononlya1'b'singlefeature[2].Asaresulteachstageoftheboostingprocess,whichselectsanewweak,canbeviewedasafeatureselectionprocess.AdaBoostprovidesaneffec-tivelearningalgorithmandstrongboundsongeneralizationperformance[13,9,10].Thethirdmajorcontributionofthispaperisamethodforcombiningsuccessivelymorecomplexinacascadestructurewhichdramaticallyincreasesthespeedofthedetectorbyfocusingattentiononpromisingregionsoftheimage.Thenotionbehindfocusofattentionapproachesisthatitisoftenpossibletorapidlydeterminewhereinanimageanobjectmightoccur[17,8,1].Morecomplexpro-cessingisreservedonlyforthesepromisingregions.Thekeymeasureofsuchanapproachisthefalsenegativerateoftheattentionalprocess.Itmustbethecasethatall,oralmostall,objectinstancesareselectedbytheattentional.Wewilldescribeaprocessfortraininganextremelysim-pleandefwhichcanbeusedasasuper-visedfocusofattentionoperator.Thetermsupervisedreferstothefactthattheattentionaloperatoristrainedtodetectexamplesofaparticularclass.Inthedomainoffacedetectionitispossibletoachievefewerthan1%falseneg-ativesand40%falsepositivesusingaconstructedfromtwoHarr-likefeatures.Theeffectofthisistoreducebyoveronehalfthenumberoflocationswherethedetectormustbeevaluated.Thosesub-windowswhicharenotrejectedbytheinitialareprocessedbyasequenceofeachslightlymorecomplexthanthelast.Ifanyrejectsthesub-window,nofurtherprocessingisperformed.Thestructureofthecascadeddetectionprocessisessentiallythatofadegeneratedecisiontree,andassuchisrelatedtotheworkofGemanandcolleagues[1,4].Anextremelyfastfacedetectorwillhavebroadprac-ticalapplications.Theseincludeuserinterfaces,imagedatabases,andteleconferencing.Inapplicationswhererapidframe-ratesarenotnecessary,oursystemwillallowforadditionalpost-processingandanalysis.Inadditionoursystemcanbeimplementedonawiderangeofsmalllowpowerdevices,includinghand-heldsandembed-dedprocessors.InourlabwehaveimplementedthisfacedetectorontheCompaqiPaqhandheldandhaveachieveddetectionattwoframespersecond(thisdevicehasalowpower200mipsStrongArmprocessorwhichlackspointhardware).Theremainderofthepaperdescribesourcontributionsandanumberofexperimentalresults,includingadetaileddescriptionofourexperimentalmethodology.Discussionofcloselyrelatedworktakesplaceattheendofeachsec-tion.\n2.FeaturesOurobjectdetectionprocedureimagesbasedonthevalueofsimplefeatures.TherearemanymotivationsABCDFigure1:Examplerectanglefeaturesshownrelativetotheenclosingdetectionwindow.Thesumofthepixelswhichliewithinthewhiterectanglesaresubtractedfromthesumofpixelsinthegreyrectangles.Two-rectanglefeaturesareshownin(A)and(B).Figure(C)showsathree-rectanglefeature,and(D)afour-rectanglefeature.forusingfeaturesratherthanthepixelsdirectly.Themostcommonreasonisthatfeaturescanacttoencodead-hocdomainknowledgethatisdiflttolearnusingaquantityoftrainingdata.Forthissystemthereisalsoasecondcriticalmotivationforfeatures:thefeaturebasedsystemoperatesmuchfasterthanapixel-basedsystem.ThesimplefeaturesusedarereminiscentofHaarbasisfunctionswhichhavebeenusedbyPapageorgiouetal.[10].More,weusethreekindsoffeatures.Thevalueofatwo-rectanglefeatureisthedifferencebetweenthesumofthepixelswithintworectangularregions.Theregionshavethesamesizeandshapeandarehorizontallyorver-ticallyadjacent(seeFigure1).Athree-rectanglefeaturecomputesthesumwithintwooutsiderectanglessubtractedfromthesuminacenterrectangle.Finallyafour-rectanglefeaturecomputesthedifferencebetweendiagonalpairsofrectangles.Giventhatthebaseresolutionofthedetectoris24x24,theexhaustivesetofrectanglefeaturesisquitelarge,over180,000.NotethatunliketheHaarbasis,thesetofrectan-glefeaturesisovercomplete1.2.1.IntegralImageRectanglefeaturescanbecomputedveryrapidlyusinganintermediaterepresentationfortheimagewhichwecalltheintegralimage.2Theintegralimageatlocationcontainsthesumofthepixelsaboveandtotheleftof,inclusive:! "#$%"1Acompletebasishasnolineardependencebetweenbasiselementsandhasthesamenumberofelementsastheimagespace,inthiscase576.Thefullsetof180,000thousandfeaturesismanytimesover-complete.2Thereisacloserelationtosummedareatablesasusedingraphics[3].Wechooseadifferentnamehereinordertoemphasizeitsusefortheanalysisofimages,ratherthanfortexturemapping.2'b'ACBD1423Figure2:Thesumofthepixelswithinrectanglecanbecomputedwithfourarrayreferences.Thevalueoftheinte-gralimageatlocation1isthesumofthepixelsinrectangle.Thevalueatlocation2is,atlocation3is,andatlocation4is.Thesumwithincanbecomputedas.whereistheintegralimageandistheorigi-nalimage.Usingthefollowingpairofrecurrences:(1)(2)(whereisthecumulativerowsum,,and)theintegralimagecanbecomputedinonepassovertheoriginalimage.Usingtheintegralimageanyrectangularsumcanbecomputedinfourarrayreferences(seeFigure2).Clearlythedifferencebetweentworectangularsumscanbecom-putedineightreferences.Sincethetwo-rectanglefeaturesdaboveinvolveadjacentrectangularsumstheycanbecomputedinsixarrayreferences,eightinthecaseofthethree-rectanglefeatures,andnineforfour-rectanglefea-tures.\n2.2.FeatureDiscussionRectanglefeaturesaresomewhatprimitivewhencomparedwithalternativessuchassteerable[5,7].Steerableters,andtheirrelatives,areexcellentforthedetailedanaly-sisofboundaries,imagecompression,andtextureanalysis.Incontrastrectanglefeatures,whilesensitivetothepres-enceofedges,bars,andothersimpleimagestructure,arequitecoarse.Unlikesteerabletheonlyorientationsavailablearevertical,horizontal,anddiagonal.Thesetofrectanglefeaturesdohoweverprovidearichimagerepre-sentationwhichsupportseffectivelearning.Inconjunctionwiththeintegralimage,theefyoftherectanglefea-turesetprovidesamplecompensationfortheirlimitedx-ibility.3.LearningFunctionsGivenafeaturesetandatrainingsetofpositiveandneg-ativeimages,anynumberofmachinelearningapproachescouldbeusedtolearnafunction.Inoursys-temavariantofAdaBoostisusedbothtoselectasmallsetoffeaturesandtrainthe[6].Initsoriginalform,theAdaBoostlearningalgorithmisusedtoboosttheclas-performanceofasimple(sometimescalledweak)learningalgorithm.Thereareanumberofformalguaran-teesprovidedbytheAdaBoostlearningprocedure.FreundandSchapireprovedthatthetrainingerrorofthestrongapproacheszeroexponentiallyinthenumberofrounds.Moreimportantlyanumberofresultswerelaterprovedaboutgeneralizationperformance[14].Thekeyinsightisthatgeneralizationperformanceisrelatedtothemarginoftheexamples,andthatAdaBoostachieveslargemarginsrapidly.Recallthatthereareover180,000rectanglefeaturesas-sociatedwitheachimagesub-window,anumberfarlargerthanthenumberofpixels.Eventhougheachfeaturecanbecomputedveryef,computingthecompletesetisprohibitivelyexpensive.Ourhypothesis,whichisborneoutbyexperiment,isthataverysmallnumberofthesefeaturescanbecombinedtoformaneffective.Themainchallengeistothesefeatures.Insupportofthisgoal,theweaklearningalgorithmisdesignedtoselectthesinglerectanglefeaturewhichbestseparatesthepositiveandnegativeexamples(thisissimilartotheapproachof[2]inthedomainofimagedatabasere-trieval).Foreachfeature,theweaklearnerdeterminestheoptimalthresholdfunction,suchthatthemin-imumnumberofexamplesareAweakclas-thusconsistsofafeature,athresholdandaparity !indicatingthedirectionoftheinequalitysign:#"if %$ otherwiseHereisa24x24pixelsub-windowofanimage.SeeTa-ble1forasummaryoftheboostingprocess.Inpracticenosinglefeaturecanperformthetiontaskwithlowerror.Featureswhichareselectedinearlyroundsoftheboostingprocesshaderrorratesbetween0.1and0.3.Featuresselectedinlaterrounds,asthetaskbe-comesmoredifyielderrorratesbetween0.4and0.5.3.1.LearningDiscussionManygeneralfeatureselectionprocedureshavebeenpro-posed(seechapter8of[18]forareview).Ourappli-cationdemandedaveryaggressiveapproachwhichwoulddiscardthevastmajorityoffeatures.Forasimilarrecogni-tionproblemPapageorgiouetal.proposedaschemeforfea-tureselectionbasedonfeaturevariance[10].Theydemon-stratedgoodresultsselecting37featuresoutofatotal1734features.Rothetal.proposeafeatureselectionprocessbasedontheWinnowexponentialperceptronlearningrule[11].TheWinnowlearningprocessconvergestoasolutionwheremanyoftheseweightsarezero.Neverthelessaverylarge3'b'Givenexampleimageswherefornegativeandpositiveexamplesrespec-tively.Initializeweights"$#"$%forrespec-tively,where\'and(arethenumberofnegativesandpositivesrespectively.For):1.Normalizetheweights,/..2.3sothat5.isaprobabilitydistribution.2.Foreachfeature,6,traina73whichisrestrictedtousingasinglefeature.Theerrorisevaluatedwithrespectto8.,93273.3.Choosethe,7.,withthelowesterror9..4.Updatetheweights:..whereDifexampleiscor-rectly,D&otherwise,and?.GIHGH.Thestrongis:7M2ON.4.-7Q."2TN.4.otherwisewhereP.OUWV+XYHTable1:TheAdaBoostalgorithmforlearn-ing.Eachroundofboostingselectsonefeaturefromthe180,000potentialfeatures.numberoffeaturesareretained(perhapsafewhundredorthousand).3.2.LearningResultsWhiledetailsonthetrainingandperformanceofthesystemarepresentedinSection5,severalsimpleresultsmeritdiscussion.Initialexperimentsdemonstratedthatafrontalfaceconstructedfrom200featuresyieldsadetectionrateof95%withafalsepositiverateof1in14084.Theseresultsarecompelling,butnotsufformanyreal-worldtasks.Intermsofcomputation,thisclas-isprobablyfasterthananyotherpublishedsystem,requiring0.7secondstoscanan384by288pixelimage.Unfortunately,themoststraightforwardtechniqueforim-provingdetectionperformance,addingfeaturestotheclas-,directlyincreasescomputationtime.Forthetaskoffacedetection,theinitialrectanglefea-turesselectedbyAdaBoostaremeaningfulandeasilyinter-preted.Thefeatureselectedseemstofocusontheprop-ertythattheregionoftheeyesisoftendarkerthantheregionFigure3:TheandsecondfeaturesselectedbyAd-aBoost.Thetwofeaturesareshowninthetoprowandthenoverlayedonatypicaltrainingfaceinthebottomrow.Thefeaturemeasuresthedifferenceinintensitybetweentheregionoftheeyesandaregionacrosstheuppercheeks.Thefeaturecapitalizesontheobservationthattheeyeregionisoftendarkerthanthecheeks.Thesecondfeaturecomparestheintensitiesintheeyeregionstotheintensityacrossthebridgeofthenose.ofthenoseandcheeks(seeFigure3).Thisfeatureisrel-ativelylargeincomparisonwiththedetectionsub-window,andshouldbesomewhatinsensitivetosizeandlocationoftheface.Thesecondfeatureselectedreliesonthepropertythattheeyesaredarkerthanthebridgeofthenose.4.TheAttentionalCascadeThissectiondescribesanalgorithmforconstructingacas-cadeofwhichachievesincreaseddetectionper-formancewhileradicallyreducingcomputationtime.Thekeyinsightisthatsmaller,andthereforemoreefboostedcanbeconstructedwhichrejectmanyofthenegativesub-windowswhiledetectingalmostallposi-tiveinstances(i.e.thethresholdofaboostedcanbeadjustedsothatthefalsenegativerateisclosetozero).Simplerareusedtorejectthemajorityofsub-windowsbeforemorecomplexarecalledupontoachievelowfalsepositiverates.Theoverallformofthedetectionprocessisthatofade-generatedecisiontree,whatwecallacascade(seeFig-ure4).Apositiveresultfromthetriggerstheevaluationofasecondwhichhasalsobeenad-justedtoachieveveryhighdetectionrates.Apositiveresultfromthesecondtriggersathird,andsoon.Anegativeoutcomeatanypointleadstotheimmediaterejectionofthesub-window.Stagesinthecascadeareconstructedbytrainingclas-usingAdaBoostandthenadjustingthethresholdtominimizefalsenegatives.NotethatthedefaultAdaBoostthresholdisdesignedtoyieldalowerrorrateonthetrain-ingdata.Ingeneralalowerthresholdyieldshigherdetec-4'b"TFTFTF123Reject Sub-windowAll Sub-windowsFurtherProcessingFigure4:Schematicdepictionofathedetectioncascade.Aseriesofareappliedtoeverysub-window.Theinitialeliminatesalargenumberofnegativeexam-pleswithverylittleprocessing.Subsequentlayerseliminateadditionalnegativesbutrequireadditionalcomputation.Af-terseveralstagesofprocessingthenumberofsub-windowshavebeenreducedradically.Furtherprocessingcantakeanyformsuchasadditionalstagesofthecascade(asinourdetectionsystem)oranalternativedetectionsystem.tionratesandhigherfalsepositiverates.Forexampleanexcellentstagecanbecon-structedfromatwo-featurestrongbyreducingthethresholdtominimizefalsenegatives.Measuredagainstavalidationtrainingset,thethresholdcanbeadjustedtode-tect100%ofthefaceswithafalsepositiverateof40%.SeeFigure3foradescriptionofthetwofeaturesusedinthis.Computationofthetwofeatureamountstoabout60microprocessorinstructions.Itseemshardtoimaginethatanysimplercouldachievehigherrejec-tionrates.Bycomparison,scanningasimpleimagetem-plate,orasinglelayerperceptron,wouldrequireatleast20timesasmanyoperationspersub-window.Thestructureofthecascadethefactthatwithinanysingleimageanoverwhelmingmajorityofsub-windowsarenegative.Assuch,thecascadeattemptstore-jectasmanynegativesaspossibleattheearlieststagepos-sible.Whileapositiveinstancewilltriggertheevaluationofeveryinthecascade,thisisanexceedinglyrareevent.Muchlikeadecisiontree,subsequentaretrainedusingthoseexampleswhichpassthroughallthepreviousstages.Asaresult,thesecondfacesamorediftaskthantheTheexampleswhichmakeitthroughthestageareharderthantypicalexam-ples.Themoredifexamplesfacedbydeeperclassi-pushtheentirereceiveroperatingcharacteristic(ROC)curvedownward.Atagivendetectionrate,deeperclassi-havecorrespondinglyhigherfalsepositiverates.4.1.TrainingaCascadeofClassiThecascadetrainingprocessinvolvestwotypesoftrade-offs.Inmostcaseswithmorefeatureswillachievehigherdetectionratesandlowerfalsepositiverates.Atthesametimewithmorefeaturesrequiremoretimetocompute.Inprincipleonecouldanoptimiza-tionframeworkinwhich:i)thenumberofstages,ii)thenumberoffeaturesineachstage,andiii)thethresh-oldofeachstage,aretradedoffinordertominimizetheexpectednumberofevaluatedfeatures.Unfortunatelyingthisoptimumisatremendouslydifproblem.InpracticeaverysimpleframeworkisusedtoproduceaneffectivewhichishighlyefEachstageinthecascadereducesthefalsepositiverateanddecreasesthedetectionrate.Atargetisselectedfortheminimumreductioninfalsepositivesandthemaximumdecreaseindetection.Eachstageistrainedbyaddingfeaturesuntilthetargetdetectionandfalsepositivesratesaremet(theseratesaredeterminedbytestingthedetectoronavalidationset).Stagesareaddeduntiltheoveralltargetforfalsepositiveanddetectionrateismet.4.2.DetectorCascadeDiscussionThecompletefacedetectioncascadehas38stageswithover6000features.Neverthelessthecascadestructureresultsinfastaveragedetectiontimes.Onadifdataset,con-taining507facesand75millionsub-windows,facesaredetectedusinganaverageof10featureevaluationspersub-window.Incomparison,thissystemisabout15timesfasterthananimplementationofthedetectionsystemconstructedbyRowleyetal.3[12]Anotionsimilartothecascadeappearsinthefacede-tectionsystemdescribedbyRowleyetal.inwhichtwode-tectionnetworksareused[12].Rowleyetal.usedafasteryetlessaccuratenetworktoprescreentheimageinordertocandidateregionsforaslowermoreaccuratenetwork.Thoughitisdiftodetermineexactly,itappearsthatRowleyetal.'stwonetworkfacesystemisthefastestexist-ingfacedetector.4Thestructureofthecascadeddetectionprocessises-sentiallythatofadegeneratedecisiontree,andassuchisrelatedtotheworkofAmitandGeman[1].Unliketech-niqueswhichuseaeddetector,AmitandGemanproposeanalternativepointofviewwhereunusualco-occurrencesofsimpleimagefeaturesareusedtotriggertheevaluationofamorecomplexdetectionprocess.Inthiswaythefulldetectionprocessneednotbeevaluatedatmanyofthepo-tentialimagelocationsandscales.Whilethisbasicinsight3HenryRowleyverygraciouslysupplieduswithimplementationsofhisdetectionsystemfordirectcomparison.Reportedresultsareagainsthisfastestsystem.Itisdifttodeterminefromthepublishedliterature,buttheRowley-Baluja-Kanadedetectoriswidelyconsideredthefastestdetectionsystemandhasbeenheavilytestedonreal-worldproblems.4Otherpublisheddetectorshaveeitherneglectedtodiscussperfor-manceindetail,orhaveneverpublisheddetectionandfalsepositiveratesonalargeanddifttrainingset.5"b"isveryvaluable,intheirimplementationitisnecessarytoevaluatesomefeaturedetectorateverylocation.Thesefeaturesarethengroupedtounusualco-occurrences.Inpractice,sincetheformofourdetectorandthefeaturesthatitusesareextremelyeftheamortizedcostofevalu-atingourdetectorateveryscaleandlocationismuchfasterthanandgroupingedgesthroughouttheimage.InrecentworkFleuretandGemanhavepresentedafacedetectiontechniquewhichreliesonachainoftestsinor-dertosignifythepresenceofafaceataparticularscaleandlocation[4].TheimagepropertiesmeasuredbyFleuretandGeman,disjunctionsofscaleedges,arequitedifferentthanrectanglefeatureswhicharesimple,existatallscales,andaresomewhatinterpretable.Thetwoapproachesalsodifferradicallyintheirlearningphilosophy.ThemotivationforFleuretandGeman'slearningprocessisdensityestima-tionanddensitydiscrimination,whileourdetectorispurelydiscriminative.FinallythefalsepositiverateofFleuretandGeman'sapproachappearstobehigherthanthatofprevi-ousapproacheslikeRowleyetal.andthisapproach.Un-fortunatelythepaperdoesnotreportquantitativeresultsofthiskind.Theincludedexampleimageseachhavebetween2and10falsepositives.5ResultsA38layercascadedwastrainedtodetectfrontaluprightfaces.Totrainthedetector,asetoffaceandnon-facetrainingimageswereused.Thefacetrainingsetcon-sistedof4916handlabeledfacesscaledandalignedtoabaseresolutionof24by24pixels.Thefaceswereex-tractedfromimagesdownloadedduringarandomcrawloftheworldwideweb.SometypicalfaceexamplesareshowninFigure5.Thenon-facesubwindowsusedtotrainthedetectorcomefrom9544imageswhichweremanuallyin-spectedandfoundtonotcontainanyfaces.Thereareabout350millionsubwindowswithinthesenon-faceimages.Thenumberoffeaturesinthevelayersofthede-tectoris1,10,25,25and50featuresrespectively.Theremaininglayershaveincreasinglymorefeatures.Thetotalnumberoffeaturesinalllayersis6061.Eachinthecascadewastrainedwiththe4916trainingfaces(plustheirverticalmirrorimagesforatotalof9832trainingfaces)and10,000non-facesub-windows(alsoofsize24by24pixels)usingtheAdaboosttrainingprocedure.Fortheinitialonefeature,thenon-facetrainingexampleswerecollectedbyselectingrandomsub-windowsfromasetof9544imageswhichdidnotcon-tainfaces.Thenon-faceexamplesusedtotrainsubsequentlayerswereobtainedbyscanningthepartialcascadeacrossthenon-faceimagesandcollectingfalsepositives.Amax-imumof10000suchnon-facesub-windowswerecollectedforeachlayer.SpeedoftheFinalDetectorFigure5:Exampleoffrontaluprightfaceimagesusedfortraining.Thespeedofthecascadeddetectorisdirectlyrelatedtothenumberoffeaturesevaluatedperscannedsub-window.EvaluatedontheMIT+CMUtestset[12],anaverageof10featuresoutofatotalof6061areevaluatedpersub-window.Thisispossiblebecausealargemajorityofsub-windowsarerejectedbytheorsecondlayerinthecascade.Ona700MhzPentiumIIIprocessor,thefacedetectorcanpro-cessa384by288pixelimageinabout.067seconds(us-ingastartingscaleof1.25andastepsizeof1.5describedbelow).Thisisroughly15timesfasterthantheRowley-Baluja-Kanadedetector[12]andabout600timesfasterthantheSchneiderman-Kanadedetector[15].ImageProcessingAllexamplesub-windowsusedfortrainingwerevari-ancenormalizedtominimizetheeffectofdifferentlight-ingconditions.Normalizationisthereforenecessaryduringdetectionaswell.Thevarianceofanimagesub-windowcanbecomputedquicklyusingapairofintegralimages.Recallthat,whereisthestandarddeviation,isthemean,andisthepixelvaluewithinthesub-window.Themeanofasub-windowcanbecom-putedusingtheintegralimage.Thesumofsquaredpixelsiscomputedusinganintegralimageoftheimagesquared(i.e.twointegralimagesareusedinthescanningprocess).Duringscanningtheeffectofimagenormalizationcanbeachievedbypost-multiplyingthefeaturevaluesratherthanpre-multiplyingthepixels.ScanningtheDetectorThedetectorisscannedacrosstheimageatmulti-plescalesandlocations.Scalingisachievedbyscalingthedetectoritself,ratherthanscalingtheimage.Thisprocessmakessensebecausethefeaturescanbeevaluatedatany6"b'DetectorFalsedetections103150657895167Viola-Jones76.1%88.4%91.4%92.0%92.1%92.9%93.9%Viola-Jones(voting)81.1%89.7%92.1%93.1%93.1%93.2%93.7%Rowley-Baluja-Kanade83.2%86.0%---89.2%90.1%Schneiderman-Kanade---94.4%---Roth-Yang-Ahuja----(94.8%)--Table2:DetectionratesforvariousnumbersoffalsepositivesontheMIT+CMUtestsetcontaining130imagesand507faces.scalewiththesamecost.Goodresultswereobtainedusingasetofscalesafactorof1.25apart.Thedetectorisalsoscannedacrosslocation.Subsequentlocationsareobtainedbyshiftingthewindowsomenumberofpixels.Thisshiftingprocessisaffectedbythescaleofthedetector:ifthecurrentscaleisthewindowisshiftedby,whereistheroundingoperation.Thechoiceofaffectsboththespeedofthedetectoraswellasaccuracy.Theresultswepresentarefor.Wecanachieveaspeedupbysettingwithonlyaslightdecreaseinaccuracy.IntegrationofMultipleDetectionsSincethedetectorisinsensitivetosmallchangesintranslationandscale,multipledetectionswillusuallyoccuraroundeachfaceinascannedimage.Thesameisoftentrueofsometypesoffalsepositives.Inpracticeitoftenmakessensetoreturnonedetectionperface.Towardthisenditisusefultopostprocessthedetectedsub-windowsinordertocombineoverlappingdetectionsintoasingledetection.Intheseexperimentsdetectionsarecombinedinaverysimplefashion.Thesetofdetectionsarepartitionedintodisjointsubsets.Twodetectionsareinthesamesubsetiftheirboundingregionsoverlap.Eachpartitionyieldsasingledetection.Thecornersoftheboundingregionaretheaverageofthecornersofalldetectionsintheset.\nExperimentsonaReal-WorldTestSetWetestedoursystemontheMIT+CMUfrontalfacetestset[12].Thissetconsistsof130imageswith507labeledfrontalfaces.AROCcurveshowingtheperformanceofourdetectoronthistestsetisshowninFigure6.TocreatetheROCcurvethethresholdofthelayerisad-justedfromto.Adjustingthethresholdtowillyieldadetectionrateof0.0andafalsepositiverateof0.0.Adjustingthethresholdto,however,increasesboththedetectionrateandfalsepositiverate,butonlytoacertainpoint.Neitherratecanbehigherthantherateofthedetectioncascademinusthelayer.Ineffect,athresh-oldofisequivalenttoremovingthatlayer.Furtherincreasingthedetectionandfalsepositiveratesrequiresde-creasingthethresholdofthenextinthecascade.Thus,inordertoconstructacompleteROCcurve,layersareremoved.Weusethenumberoffalsepositivesasopposedtotherateoffalsepositivesforthex-axisoftheROCcurvetofacilitatecomparisonwithothersystems.Tocomputethefalsepositiverate,simplydividebythetotalnumberofsub-windowsscanned.Inourexperiments,thenumberofsub-windowsscannedis75,081,800.Unfortunately,mostpreviouspublishedresultsonfacedetectionhaveonlyincludedasingleoperatingregime(i.e.singlepointontheROCcurve).Tomakecomparisonwithourdetectoreasierwehavelistedourdetectionrateforthefalsepositiveratesreportedbytheothersystems.Table2liststhedetectionrateforvariousnumbersoffalsedetec-tionsforoursystemaswellasotherpublishedsystems.FortheRowley-Baluja-Kanaderesults[12],anumberofdiffer-entversionsoftheirdetectorweretestedyieldinganumberofdifferentresultstheyarealllistedinunderthesamehead-ing.FortheRoth-Yang-Ahujadetector[11],theyreportedtheirresultontheMIT+CMUtestsetminus5imagescon-taininglinedrawnfacesremoved.Figure7showstheoutputofourfacedetectoronsometestimagesfromtheMIT+CMUtestset.AsimplevotingschemetofurtherimproveresultsIntable2wealsoshowresultsfromrunningthreede-tectors(the38layeronedescribedaboveplustwosimilarlytraineddetectors)andoutputtingthemajorityvoteofthethreedetectors.Thisimprovesthedetectionrateaswellaseliminatingmorefalsepositives.Theimprovementwouldbegreaterifthedetectorsweremoreindependent.Thecor-relationoftheirerrorsresultsinamodestimprovementoverthebestsingledetector.6ConclusionsWehavepresentedanapproachforobjectdetectionwhichminimizescomputationtimewhileachievinghighdetectionaccuracy.Theapproachwasusedtoconstructafacede-tectionsystemwhichisapproximately15fasterthananypreviousapproach.Thispaperbringstogethernewalgorithms,representa-tions,andinsightswhicharequitegenericandmaywell7'b"Figure7:OutputofourfacedetectoronanumberoftestimagesfromtheMIT+CMUtestset.Figure6:ROCcurveforourfacedetectorontheMIT+CMUtestset.Thedetectorwasrunusingastepsizeof1.0andstartingscaleof1.0(75,081,800sub-windowsscanned).havebroaderapplicationincomputervisionandimagepro-cessing.Finallythispaperpresentsasetofdetailedexperimentsonadiffacedetectiondatasetwhichhasbeenwidelystudied.Thisdatasetincludesfacesunderaverywiderangeofconditionsincluding:illumination,scale,pose,andcam-eravariation.Experimentsonsuchalargeandcomplexdatasetaredifandtimeconsuming.Neverthelesssys-temswhichworkundertheseconditionsareunlikelytobebrittleorlimitedtoasinglesetofconditions.Moreimpor-tantlyconclusionsdrawnfromthisdatasetareunlikelytobeexperimentalartifacts.References[1]Y.Amit,D.Geman,andK.Wilder.Jointinductionofshapefeaturesandtree1997.[2]Anonymous.Anonymous.InAnonymous,2000.[3]F.Crow.Summed-areatablesfortexturemapping.InProceedingsofSIGGRAPH,volume18(3),pages207212,1984.[4]F.FleuretandD.Geman.facedetection.Int.J.ComputerVision,2001.[5]WilliamT.FreemanandEdwardH.Adelson.ThedesignanduseofsteerableIEEETransactionsonPatternAnalysisandMachineIntelligence,13(9):891906,1991.[6]YoavFreundandRobertE.Schapire.Adecision-theoreticgeneralizationofon-linelearningandanapplicationtoboosting.InComputationalLearningTheory:Eurocolt'95,pages2337.Springer-Verlag,1995.[7]H.Greenspan,S.Belongie,R.Gooodman,P.Perona,S.Rak-shit,andC.Anderson.Overcompletesteerablepyramidtersandrotationinvariance.InProceedingsoftheIEEECon-ferenceonComputerVisionandPatternRecognition,1994.[8]L.Itti,C.Koch,andE.Niebur.Amodelofsaliency-basedvisualattentionforrapidsceneanalysis.IEEEPatt.Anal.Mach.Intell.,20(11):12541259,November1998.[9]EdgarOsuna,RobertFreund,andFedericoGirosi.Trainingsupportvectormachines:anapplicationtofacedetection.InProceedingsoftheIEEEConferenceonComputerVisionandPatternRecognition,1997.[10]C.Papageorgiou,M.Oren,andT.Poggio.Ageneralframe-workforobjectdetection.InInternationalConferenceonComputerVision,1998.[11]D.Roth,M.Yang,andN.Ahuja.Asnowbasedfacedetector.InNeuralInformationProcessing12,2000.[12]H.Rowley,S.Baluja,andT.Kanade.Neuralnetwork-basedfacedetection.InIEEEPatt.Anal.Mach.Intell.,volume20,pages2238,1998.[13]R.E.Schapire,Y.Freund,P.Bartlett,andW.S.Lee.Boost-ingthemargin:anewexplanationfortheeffectivenessofvotingmethods.Ann.Stat.,26(5):16511686,1998.[14]RobertE.Schapire,YoavFreund,PeterBartlett,andWeeSunLee.Boostingthemargin:Anewexplanationfortheeffectivenessofvotingmethods.InProceedingsoftheFourteenthInternationalConferenceonMachineLearning,1997.[15]H.SchneidermanandT.Kanade.Astatisticalmethodfor3Dobjectdetectionappliedtofacesandcars.InInternationalConferenceonComputerVision,2000.8"b'[16]K.SungandT.Poggio.Example-basedlearningforview-basedfacedetection.InIEEEPatt.Anal.Mach.Intell.,vol-ume20,pages3951,1998.[17]J.K.Tsotsos,S.M.Culhane,W.Y.K.Wai,Y.H.Lai,N.Davis,andF.Modelingvisual-attentionviaselectivetun-ing.IntelligenceJournal,78(1-2):507545,Octo-ber1995.[18]AndrewWebb.StatisticalPatternRecognition.OxfordUni-versityPress,NewYork,1999.9'